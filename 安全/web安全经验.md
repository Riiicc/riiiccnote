## web安全经验
开发前尽量避免的问题，此文档大部分为渗透测试后的总结

### 弱口令
1. 强制用户首次登录时修改默认口令，或者使用用户自定义初始密码的策略。  
2. 完善密码策略，信息安全最佳实践的密码策略为8位（包括）以上字符，包含数字、大小写字母、特殊字符中的至少3种。  
3. 增加人机验证机制，限制IP访问次数。  

> 还应该注意：服务器，中间件默认端口（22、3306、6379...），服务器密码登录错误限制IP

### XSS 
XSS攻击对Web服务器本身虽无直接危害，但是它借助网站进行传播，对网站用户进行攻击，窃取网站用户账号身份信息等，从而也会对网站产生较严重的威胁。  

1. 过滤输入的数据，对例如：“ ‘ ”，“ “ ”，” < “，” > “，” on* “，script、iframe等危险字符进行严格的检查。这里的输入不仅仅是用户可以直接交互的输入接口，也包括HTTP请求中的Cookie中的变量，HTTP请求头部中的变量等。  
2. 不仅验证数据的类型，还要验证其格式、长度、范围和内容。  
3. 不仅在客户端做数据的验证与过滤，关键的过滤步骤在服务端进行。  
4. 对输出到页面的数据进行相应的编码转换，如HTML实体编码、JS编码等。对输出的数据也要检查，数据库里的值有可能会在一个大网站的多处都有输出，即使在输入做了编码等操作，在各处的输出点时也要进行检查。  


### SQL注入
> 关键是对来自用户输入的数据进行严格的检查、对数据库配置使用最小权限原则。  

1. 所有查询语句都使用数据库提供的参数化查询接口
2. 对进入数据库的特殊字符（'"尖括号&*;等）进行转义处理，或编码转换。
3. 严格限制变量类型。
4. 数据长度严格规定。
5. 网站每个数据层的编码统一，建议全部使用UTF-8编码。
6. 不使用管理员权限的数据库连接，为每个应用使用单独的权限有限的数据库连接。
7. 应用的异常信息应该给出尽可能少的提示，最好使用自定义的错误信息对原始错误信息进行包装。
8. 确认PHP配置文件中的magicquotesgpc选项保持开启。
9. 在部署你的应用前，始终要做安全审评(security review)。
10. 不要把机密信息直接明文存储，加密或者hash掉密码和敏感的信息。
11. 使用第三方Web防火墙来加固整个网站系统。
12. 过滤客户端提交的危险字符，比如一些符号和数据库关键词等。


### 任意文件读取  
> 未对用户输入的文件名做安全校验处理，导致用户可以查看和下载任意文件。  

1. 对用户输入的参数进行校验；  
2. 限制用户访问的文件范围；  
3. 过滤../，防止用户进行目录遍历；  
4. 文件映射，存储和应用分离；   

### 任意文件上传
> 代码没有严格限制和验证用户上传的文件后缀、类型等，攻击者可通过文件上传点上传任意文件，包括网站后门文件（webshell）控制整个网站

1. 对上传文件类型进行验证，除在前端验证外在后端依然要做验证，后端可以进行扩展名检测，重命名文件，MIME类型检测以及限制上传文件的大小等限制来防御，或是将上传的文件其他文件存储服务器中。  
2. 严格限制和校验上传的文件，禁止上传恶意代码的文件。同时限制相关上传文件目录的执行权限，防止木马执行。  
3. 对上传文件格式进行严格校验，防止上传恶意脚本文件；    
4. 严格限制上传的文件路径。  
5. 文件扩展名服务端白名单校验。  
6. 文件内容服务端校验。  
7. 上传文件重命名。  
8. 隐藏上传文件路径。  

### 用户名枚举
修改应用程序当用户名和密码错误时都提示“用户名或密码错误”。

### Druid未授权访问  
> Druid提供的监控功能，监控SQL的执行时间、监控Web URI的请求、Session监控，当开发者配置不当时就可能造成未授权访问漏洞，攻击者可通过监控页面中的session信息直接登陆系统。

1. 通过配置管理Druid监控面板
2. 配置监控面板登录 

### 敏感信息泄露
> 请求报错信息，数据库信息等泄露
1. 如果是探针或测试页面等无用的程序建议删除，或者修改成难以猜解的名字。  
2. 不影响业务或功能的情况下删除或禁止访问泄露敏感信息页面。  
3. 在服务端对相关敏感信息进行模糊化处理  
4. 对服务端返回的数据进行严格的检查，满足查询数据与页面显示数据一致。  

### 未授权访问
把控接口权限，对于免验证的接口要最小化访问信息范围    

## 参考资料
> - []()
> - []()
