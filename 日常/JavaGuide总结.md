# è¯´æ˜
ğŸ’£ å¾…å®Œå–„å­¦ä¹ ç»†åŒ–  
â­ é‡ç‚¹å…³æ³¨
# åŸºç¡€

## JVM JDK JRE
JRE æ˜¯ Java è¿è¡Œæ—¶ç¯å¢ƒå®ƒä¸èƒ½ç”¨äºåˆ›å»ºæ–°ç¨‹åº
JDK æ˜¯ Java Development Kit ç¼©å†™ï¼Œå®ƒæ˜¯åŠŸèƒ½é½å…¨çš„ Java SDKã€‚å®ƒæ‹¥æœ‰ JRE æ‰€æ‹¥æœ‰çš„ä¸€åˆ‡ï¼Œè¿˜æœ‰ç¼–è¯‘å™¨ï¼ˆjavacï¼‰å’Œå·¥å…·ï¼ˆå¦‚ javadoc å’Œ jdbï¼‰ã€‚å®ƒèƒ½å¤Ÿåˆ›å»ºå’Œç¼–è¯‘ç¨‹åºã€‚

## å­—èŠ‚ç 
JVMå¯ä»¥ç†è§£çš„ä»£ç å«åšå­—èŠ‚ç `.class` æ–‡ä»¶ï¼Œé€šè¿‡å­—èŠ‚ç æ–‡ä»¶å¯ä»¥æ— éœ€ç¼–è¯‘åœ¨ä¸åŒç³»ç»Ÿè¿è¡Œjavaç¨‹åº 
é€šè¿‡è¿è¡Œæ—¶ç¼–è¯‘ JITç¼–è¯‘å™¨,å®Œæˆç¼–è¯‘å,ä¼šå°†å…¶å­—èŠ‚ç å¯¹åº”çš„æœºå™¨ç ä¿å­˜,ä¸‹æ¬¡ç›´æ¥ä½¿ç”¨, **javaæ˜¯ç¼–è¯‘ä¸è§£é‡Šå…±å­˜çš„è¯­è¨€**

## ä¸ºä»€ä¹ˆjavaæ˜¯ç¼–è¯‘ä¸è§£é‡Šå…±å­˜
javaç¨‹åºè¦å…ˆç¼–è¯‘åè§£é‡Š,å…ˆç¼–è¯‘ç”Ÿæˆ.classæ–‡ä»¶,é€šè¿‡javaè§£é‡Šå™¨è§£é‡Šæ‰§è¡Œ

## å­—ç¬¦å‹å¸¸é‡,å­—ç¬¦ä¸²
å­—ç¬¦å¸¸é‡ æ˜¯å•å¼•å·å¼•èµ·çš„ä¸€ä¸ªå­—ç¬¦,åªå 2å­—èŠ‚

## å¯å˜å‚æ•° 
```java
public static void method(String... args){

}
```
- å¯å˜å‚æ•°åªèƒ½ä½œä¸ºå‡½æ•°æœ€åä¸€ä¸ªå‚æ•°
- æ–¹æ³•é‡è½½ä¼˜å…ˆåŒ¹é…å›ºå®šå‚æ•°æ–¹æ³•

## break continue return 
- break è·³å‡ºå½“å‰æ•´ä¸ªå¾ªç¯ä½“(åªè·³å‡ºä¸€å±‚,åµŒå¥—å¾ªç¯åªè·³å‡ºæ‰€åœ¨å¾ªç¯ä½“,å¤–å±‚å¾ªç¯ç»§ç»­æ‰§è¡Œ),ç›´æ¥è·³å‡ºå¤–å±‚çœ‹ä¸‹é¢ä»£ç 
- continue è·³è¿‡å½“æ¬¡å¾ªç¯,æ‰§è¡Œä¸‹æ¬¡å¾ªç¯
- return è·³å‡ºæ–¹æ³•

```java
public class LinshiTest {
    public static void main(String[] args) {
        out:
        for (int i = 0; i < 10; i++) {
            System.out.println("iii"+i);
            for (int j = 0; j < 5; j++) {
                if(j==3){
                    break out;
                }
                System.out.println("jjj"+j);
            }
        }
    }
}
```

## æ–¹æ³•

### é™æ€æ–¹æ³•ä¸ºä»€ä¹ˆä¸èƒ½è°ƒç”¨éé™æ€æˆå‘˜
- é™æ€æ–¹æ³•å±äºç±»,ç±»åŠ è½½å°±ä¼šåˆ†é…å†…å­˜,å¯ä»¥é€šè¿‡ç±»åç›´æ¥è®¿é—®,
- éé™æ€æˆå‘˜å¿…é¡»åœ¨å¯¹è±¡å®ä¾‹åŒ–åæ‰èƒ½è®¿é—®
- åœ¨ç±»çš„éé™æ€æˆå‘˜ä¸å­˜åœ¨çš„æ—¶å€™é™æ€æˆå‘˜å°±å·²ç»å­˜åœ¨äº†,æ­¤æ—¶è°ƒç”¨éæ³•

### æ–¹æ³•é‡è½½\é‡å†™

é‡è½½:
- å‘ç”Ÿåœ¨åŒä¸€ä¸ªç±»ä¸­ï¼ˆæˆ–è€…çˆ¶ç±»å’Œå­ç±»ä¹‹é—´ï¼‰
- æ–¹æ³•åå¿…é¡»ç›¸åŒ,å‚æ•°ç±»å‹,ä¸ªæ•°,é¡ºåº,è¿”å›å€¼,ä¿®é¥°ç¬¦ å¯ä»¥ä¸åŒ
- Java å…è®¸é‡è½½ä»»ä½•æ–¹æ³•ï¼Œ è€Œä¸åªæ˜¯æ„é€ å™¨æ–¹æ³•

é‡å†™:
- å­ç±»å¯¹çˆ¶ç±»çš„å…è®¸è®¿é—®çš„æ–¹æ³•çš„å®ç°è¿‡ç¨‹è¿›è¡Œé‡æ–°ç¼–å†™
- æ–¹æ³•åã€å‚æ•°åˆ—è¡¨å¿…é¡»ç›¸åŒï¼Œå­ç±»æ–¹æ³•è¿”å›å€¼ç±»å‹åº”æ¯”çˆ¶ç±»æ–¹æ³•è¿”å›å€¼ç±»å‹æ›´å°æˆ–ç›¸ç­‰ï¼ŒæŠ›å‡ºçš„å¼‚å¸¸èŒƒå›´å°äºç­‰äºçˆ¶ç±»ï¼Œè®¿é—®ä¿®é¥°ç¬¦èŒƒå›´å¤§äºç­‰äºçˆ¶ç±»
- å¦‚æœçˆ¶ç±»æ–¹æ³•è®¿é—®ä¿®é¥°ç¬¦ä¸º `private/final/static` åˆ™å­ç±»å°±ä¸èƒ½é‡å†™è¯¥æ–¹æ³•ï¼Œä½†æ˜¯è¢« static ä¿®é¥°çš„æ–¹æ³•èƒ½å¤Ÿè¢«å†æ¬¡å£°æ˜
- æ„é€ æ–¹æ³•æ— æ³•é‡å†™

> é‡å†™å°±æ˜¯å­ç±»å¯¹çˆ¶ç±»æ–¹æ³•çš„é‡æ–°æ”¹é€ ,å¤–éƒ¨æ ·å­ä¸èƒ½å˜,å†…éƒ¨é€»è¾‘å¯ä»¥æ”¹å˜  

![](https://hexoric-1310528773.cos.ap-beijing.myqcloud.com/hexo/guide1.png)  


## == equals() 
`==` åŸºæœ¬æ•°æ®ç±»å‹ æ¯”è¾ƒå€¼,å¼•ç”¨æ•°æ®ç±»å‹æ¯”è¾ƒå†…å­˜åœ°å€
`equals()` æ–¹æ³• æ˜¯Objectç±»æ–¹æ³•,é»˜è®¤ä½¿ç”¨ `==` åˆ¤æ–­,

## hashCode() equals()

> ä¸¤ä¸ªç›¸ç­‰çš„å¯¹è±¡`hashCode()` å¿…é¡»ç›¸ç­‰,å¦‚æœequalsæ–¹æ³•åˆ¤æ–­ä¸ºç›¸ç­‰çš„å¯¹è±¡,ä»–ä»¬çš„hashcodeå€¼ä¹Ÿè¦ç›¸ç­‰
> å¦‚æœé‡å†™equalsæ–¹æ³•æ²¡æœ‰é‡å†™hashcodeæ–¹æ³•,å¯èƒ½ä¼šå¯¼è‡´equalsæ–¹æ³•åˆ¤æ–­ç›¸ç­‰,è€Œhashcodeå´ä¸ç›¸ç­‰

## åŸºæœ¬æ•°æ®ç±»å‹
- å››ç§åŸºæœ¬æ•´å‹ `byte` `short` `int` `long` ä¸¤ç§æµ®ç‚¹ `float` `double` ä¸€ç§å­—ç¬¦å‹ `char` ä¸€ç§å¸ƒå°”å‹ `boolean` 
- æ³¨æ„ä»–ä»¬å¯¹åº”çš„åŒ…è£…ç±»å‹ å¦‚:`Character` é»˜è®¤å€¼ä¸ºnull 
- åŸºæœ¬æ•°æ®ç±»å‹å å†…å­˜å°‘ åœ¨javaè™šæ‹Ÿæœºæ ˆ æ–¹æ³•æ ˆå¸§ ä¸­çš„å±€éƒ¨å˜é‡è¡¨ 

## åŸºæœ¬æ•°æ®ç±»å‹çš„äºŒå…ƒè¿ç®—å‚è€ƒ
> `double` > `float` > `long` > `int`


![](https://hexoric-1310528773.cos.ap-beijing.myqcloud.com/hexo/gudie2.png)



## & && | ||
- `exp1 && exp2` è‹¥ `exp1` false `exp2` ä¸ä¼šè¿›è¡Œè®¡ç®—,`çŸ­è·¯`è¿ç®—  
- `exp1 || exp2` è‹¥ `exp1` true `exp2` ä¸ä¼šè¿›è¡Œè®¡ç®—,,`çŸ­è·¯`è¿ç®—  
- `&` åŒä¸º1æ—¶ä¸º1ï¼Œå¦åˆ™ä¸º0,æ— è®ºå¦‚ä½•éƒ½ä¼šè®¡ç®—ä¸¤è¾¹çš„è¡¨è¾¾å¼,é`çŸ­è·¯`è¿ç®—  
- `|` åŒæ—¶0æ—¶ä¸º0,å¦åˆ™ä¸º1 ,æ— è®ºå¦‚ä½•éƒ½ä¼šè®¡ç®—ä¸¤è¾¹çš„è¡¨è¾¾å¼,é`çŸ­è·¯`è¿ç®—  

## å³ç»“åˆè¿ç®—ç¬¦
- `a+=b+=c` => `a += (b += c)` 
- `=` `+=` `-=`


## æ•°ç»„åˆ›å»º
```java
// æ•°æ®ç±»å‹[]  å˜é‡å = new æ•°æ®ç±»å‹[å­˜å‚¨å…ƒç´ çš„ä¸ªæ•°]  
int[] x; //å£°æ˜ä¸€ä¸ªint[]ç±»å‹çš„å˜é‡  
x=new int[100]; //å’Œä¸Šé¢ç»„æˆæ•°ç»„çš„å®šä¹‰  å¯ä½œä¸ºåŒ¿åæ•°ç»„  
int[] arr = new int[4];  
arr[0] = 1;  
// æ•°ç»„ç±»å‹[] å˜é‡å = new æ•°ç»„ç±»å‹[]{å…ƒç´ 1,å…ƒç´ 2 ...}  
int[] arr = new int[]{ 1, 2, 3, 4, 5 };  
// æ•°ç»„ç±»å‹[] å˜é‡å = {å…ƒç´ 1,å…ƒç´ 2 ...}  
int[] arr = { 1, 2, 3, 4, 5 };  
```



 ## åŒ…è£…ç±»å‹çš„å¸¸é‡æ±  
> `Byte,Short,Integer,Long` è¿™ 4 ç§åŒ…è£…ç±»é»˜è®¤åˆ›å»ºäº†æ•°å€¼ `[-128ï¼Œ127]` çš„ç›¸åº”ç±»å‹çš„ç¼“å­˜æ•°æ®ï¼Œ
> `Character` åˆ›å»ºäº†æ•°å€¼åœ¨ `[0,127]` èŒƒå›´çš„ç¼“å­˜æ•°æ®ï¼Œ`Boolean` ç›´æ¥è¿”å› `True or False`

```java
Integer i1 = 33;
Integer i2 = 33;
System.out.println(i1 == i2);// è¾“å‡º true
```
## è‡ªåŠ¨è£…ç®±æ‹†ç®±

```java
Integer i = 10;  //è£…ç®±
int n = i;   //æ‹†ç®±
```
è£…ç®±å…¶å®å°±æ˜¯è°ƒç”¨äº† åŒ…è£…ç±»çš„`valueOf()`æ–¹æ³•ï¼Œæ‹†ç®±å…¶å®å°±æ˜¯è°ƒç”¨äº† `xxxValue()`æ–¹æ³•


## æˆå‘˜å˜é‡ å±€éƒ¨å˜é‡
- æˆå‘˜å˜é‡å±äºç±»,å¯ä»¥è¢« `public...` `static` ç­‰ä¿®é¥°,å¯ä»¥è¢«`final`ä¿®é¥°,å±äºç±»æˆ–è€…å®ä¾‹,éšå¯¹è±¡åˆ›å»ºå’Œæ¶ˆå¤±,è‡ªåŠ¨èµ‹å€¼é»˜è®¤å€¼
- å±€éƒ¨å˜é‡å±äºæ–¹æ³•,ä¸èƒ½è¢«æ§åˆ¶ä¿®é¥°ç¬¦åŠ `static` ä¿®é¥°,å¯ä»¥è¢«`final`ä¿®é¥°,å±äºæ–¹æ³•,å­˜åœ¨äºæ ˆå†…å­˜,éšæ–¹æ³•è°ƒç”¨è€Œæ¶ˆå¤±,ä¸ä¼šè‡ªåŠ¨èµ‹å€¼ 


## å†…éƒ¨ç±»
- æˆå‘˜å†…éƒ¨ç±»
  - å†…éƒ¨ç±»å¯ä»¥æ— é™åˆ¶çš„è®¿é—®å¤–å›´ç±»çš„æ‰€æœ‰ æˆå‘˜å±æ€§å’Œæ–¹æ³•
  - å¤–å›´ç±»è®¿é—®å†…éƒ¨ç±»è¦é€šè¿‡å†…éƒ¨ç±»å®ä¾‹è®¿é—®
  - æˆå‘˜å†…éƒ¨ç±»ä¸èƒ½å­˜åœ¨ä»»ä½•staticå˜é‡å’Œæ–¹æ³•
  - æˆå‘˜å†…éƒ¨ç±»ä¾é™„äºå¤–éƒ¨ç±»
- å±€éƒ¨å†…éƒ¨ç±»
  - æ–¹æ³•å†…éƒ¨çš„ç±»,ä¸èƒ½ç”¨publicæˆ–è€…privateä¿®é¥°
  - å±æ€§åªèƒ½åœ¨æ–¹æ³•å†…éƒ¨ç”Ÿæ•ˆ
- åŒ¿åå†…éƒ¨ç±»(æ–°å»ºæ¥å£å¯¹è±¡/ç±»å¯¹è±¡)
- é™æ€å†…éƒ¨ç±»
  - åˆ›å»ºä¸éœ€è¦ä¾èµ–å¤–éƒ¨ç±»å¯¹è±¡
  - ä¸èƒ½ä½¿ç”¨ä»»ä½•å¤–éƒ¨ç±»çš„éstatic æˆå‘˜å˜é‡å’Œæ–¹æ³•




## é™æ€åŸŸ é™æ€å¸¸é‡ final åŸŸ
```java
//æ²¡æœ‰finalé™æ€åŸŸ
private static int nextId = 1;
//é™æ€å¸¸é‡
private static final int APD = 1;
//final åŸŸ
private final int xxid =123;
```

> finalåŸŸè¦æœ‰åˆå§‹å€¼æˆ–è€…åœ¨æ„é€ æ–¹æ³•ä¸­èµ‹å€¼,åœ¨æ„é€ å¯¹è±¡åå°±ä¸èƒ½ä¿®æ”¹å€¼  

## é™æ€æ–¹æ³•
- ä¸å¯è®¿é—®å¯¹è±¡çŠ¶æ€,æ‰€éœ€å‚æ•°éƒ½é€šè¿‡æ˜¾å¼æä¾›
- åªèƒ½è®¿é—®ç±»çš„é™æ€åŸŸ  

## final ç±»å’Œæ–¹æ³•
- finalç±»ä¸èƒ½ç»§æ‰¿,ç±»ä¸­æ–¹æ³•é»˜è®¤ä¸ºfinalæ–¹æ³•
- å­ç±»ä¸èƒ½è¦†ç›–finalæ–¹æ³•
- ä½¿ç”¨finalæ–¹æ³•ä¸»è¦ç›®çš„å°±æ˜¯ç¡®ä¿å®ƒä»¬ä¸ä¼šå†å­ç±»ä¸­æ”¹å˜è¯­ä¹‰


## æ„é€ æ–¹æ³•
æ„é€ æ–¹æ³•ä¸»è¦ä½œç”¨æ˜¯å®Œæˆå¯¹ç±»å¯¹è±¡çš„åˆå§‹åŒ–å·¥ä½œ

æ„é€ æ–¹æ³•ç‰¹ç‚¹:
- åå­—ä¸ç±»åç›¸åŒ
- æ²¡æœ‰è¿”å›å€¼
- ç”Ÿæˆç±»çš„å¯¹è±¡è‡ªåŠ¨æ‰§è¡Œæ— éœ€è°ƒç”¨
- ä¸èƒ½é‡å†™,å¯ä»¥é‡è½½,ä¸€ä¸ªç±»ä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªæ„é€ å‡½æ•°

## æ·±æ‹·è´ æµ…æ‹·è´
æµ…æ‹·è´: å¯¹è±¡å†…éƒ¨çš„å¼•ç”¨å¯¹è±¡ä¼šç›´æ¥å¤åˆ¶å†…å­˜åœ°å€,æ‹·è´åçš„å¯¹è±¡å†…éƒ¨çš„å¼•ç”¨å¯¹è±¡å’Œæ‹·è´å‰çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡  
æ·±æ‹·è´: å¯¹è±¡å†…éƒ¨çš„å¼•ç”¨å¯¹è±¡é‡å†™clone æ–¹æ³• ,å¹¶ä¸”åœ¨å¯¹è±¡å†…éƒ¨cloneæ–¹æ³•è°ƒç”¨å¼•ç”¨å¯¹è±¡cloneæ–¹æ³•èµ‹å€¼,æ‹·è´åå¯¹è±¡å†…éƒ¨çš„å¼•ç”¨å¯¹è±¡å’Œæ‹·è´å‰ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡  

å®ç°`Cloneable` æ¥å£ é‡å†™ `clone()` æ–¹æ³•

```java
@Override
public Person clone() {
    try {
        Person person = (Person) super.clone();
        person.setAddress(person.getAddress().clone());
        return person;
    } catch (CloneNotSupportedException e) {
        throw new AssertionError();
    }
}

```

## String StringBuffer StringBuilder  

- `String` ä½¿ç”¨finalä¿®é¥° ä¸å¯å˜,ä¸å¯ç»§æ‰¿
- `StringBuffer` å’Œ `StringBuilder` éƒ½ç»§æ‰¿è‡ª `AbstractStringBuilder` 
- `StringBuffer` çº¿ç¨‹å®‰å…¨ æ€§èƒ½ç•¥ä½
- `StringBuilder` çº¿ç¨‹ä¸å®‰å…¨

### å­—ç¬¦æ‹¼æ¥
> Java è¯­è¨€æœ¬èº«å¹¶ä¸æ”¯æŒè¿ç®—ç¬¦é‡è½½ï¼Œâ€œ+â€å’Œâ€œ+=â€æ˜¯ä¸“é—¨ä¸º String ç±»é‡è½½è¿‡çš„è¿ç®—ç¬¦ï¼Œä¹Ÿæ˜¯ Java ä¸­ä»…æœ‰çš„ä¸¤ä¸ªé‡è½½è¿‡çš„å…ƒç´ ç¬¦  
> å¯¹è±¡å¼•ç”¨å’Œâ€œ+â€çš„å­—ç¬¦ä¸²æ‹¼æ¥æ–¹å¼ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡ StringBuilder è°ƒç”¨ append() æ–¹æ³•å®ç°çš„ï¼Œæ‹¼æ¥å®Œæˆä¹‹åè°ƒç”¨ toString() å¾—åˆ°ä¸€ä¸ª String å¯¹è±¡  


### å­—ç¬¦ä¸²å¸¸é‡æ± 
> å­—ç¬¦ä¸²å¸¸é‡æ±  æ˜¯ JVM ä¸ºäº†æå‡æ€§èƒ½å’Œå‡å°‘å†…å­˜æ¶ˆè€—é’ˆå¯¹å­—ç¬¦ä¸²ï¼ˆString ç±»ï¼‰ä¸“é—¨å¼€è¾Ÿçš„ä¸€å—åŒºåŸŸï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†é¿å…å­—ç¬¦ä¸²çš„é‡å¤åˆ›å»º
> 1.7 ä¹‹å‰åœ¨æ–¹æ³•åŒº  ä¹‹åå†å †ä¸­


## æŠ½è±¡ç±»
- åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæŠ½è±¡æ–¹æ³•çš„ç±»æœ¬èº«å¿…é¡»è¢«å£°æ˜ä¸ºæŠ½è±¡
- æŠ½è±¡ç±»å……å½“å ä½è§’è‰²ï¼Œä»–ä»¬çš„å…·ä½“å®ç°åœ¨å­ç±»ä¸­
- æŠ½è±¡ç±»ä¹Ÿå¯ä»¥åŒ…å«å…·ä½“æ–¹æ³•å’Œå±æ€§
- æ‰©å±•æŠ½è±¡ç±»
  - å­ç±»å®ç°éƒ¨åˆ†æŠ½è±¡æ–¹æ³•æˆ–è€…ä¸å®ç°æŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å¿…é¡»ä¸ºæŠ½è±¡ç±»
  - å­ç±»å®ç°å…¨éƒ¨æŠ½è±¡æ–¹æ³•ï¼Œå­ç±»ä¸ä¸ºæŠ½è±¡ç±»
- æŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–

## æ¥å£
- æ¥å£ä¸æ˜¯ç±» 
- æ¥å£ä¸èƒ½åŒ…å«å®ä¾‹åŸŸæˆ–é™æ€æ–¹æ³•,ä½†å¯ä»¥åŒ…å«å¸¸é‡
- java8 åæ¥å£å¯ä»¥åŒ…å«é™æ€æ–¹æ³•,ä½†æ˜¯é™æ€æ–¹æ³•åªèƒ½é€šè¿‡æ¥å£ç›´æ¥è°ƒç”¨,å®ç°ç±»æ— æ³•è°ƒç”¨
- java8 åå¯ä»¥ä¸ºæ¥å£æä¾›ä¸€ä¸ªé»˜è®¤å®ç°,å¿…é¡»ç”¨`default` ä¿®é¥°è¿™ä¸ªæ–¹æ³•,é»˜è®¤å®ç°å¯ä»¥é€šè¿‡æ¥å£å’Œå®ç°ç±»å¯¹è±¡è°ƒç”¨




## æ³›å‹ 
> JDK5 å¼•å…¥ åŒ…æ‹¬æ³›å‹ç±»ã€æ³›å‹æ¥å£ã€æ³›å‹æ–¹æ³•  
> ä¸€èˆ¬æƒ…å†µä¸‹ E è¡¨ç¤ºé›†åˆå…ƒç´ , KVè¡¨ç¤ºmapç±»å‹,T U S è¡¨ç¤ºä»»æ„ç±»å‹

```java
//æ³›å‹ç±»
class Pair<R>{
    private R first;
}

class Pair<R,T>{
    private R first;
    private T second;
}

//æ³›å‹æ¥å£
public interface Generator<T> {
    public T method();
}

//æ³›å‹æ–¹æ³•
public <E> void printarr(E[] ss ){
}

//æ³›å‹ç±»å‹é™å®š ç±»å’Œæ–¹æ³•éƒ½å¯ä»¥ä½¿ç”¨
class Pair<T extends Comparable>{
    private T second;
}

```

### ç±»å‹æ“¦é™¤
> æ— è®ºä½•æ—¶å®šä¹‰ä¸€ä¸ªæ³›å‹ç±»å‹,éƒ½è‡ªåŠ¨æä¾›äº†ä¸€ä¸ªç›¸åº”çš„åŸå§‹ç±»å‹,åŸå§‹ç±»å‹çš„åå­—å°±æ˜¯åˆ å»ç±»å‹å‚æ•°åçš„æ³›å‹ç±»å‹å.
> æ“¦é™¤ç±»å‹å˜é‡,å¹¶æ›¿æ¢ä¸ºé™å®šç±»å‹,æ— é™å®šç±»å‹çš„å˜é‡ç”¨ `Object`
> ` Pair < T >` åŸå§‹ç±»å‹ä¸º `Pair` å› ä¸ºTæ˜¯æ— é™å®šçš„å˜é‡,æ‰€ä»¥ç›´æ¥ç”¨Object æ›¿æ¢ 

æœ‰é™å®šç±»å‹æ›¿æ¢   
![](https://hexoric-1310528773.cos.ap-beijing.myqcloud.com/hexo/guide3.png)

```java
//ç±»å‹æ“¦é™¤è¯´æ˜
public class ErasedTypeEquivalence {
    public static void main(String[] args) {
        Class c1 = new ArrayList<String>().getClass();
        Class c2 = new ArrayList<Integer>().getClass();
        System.out.println(c1 == c2); //true
    }
}
```

## åå°„
```java
Class cl = Class.forName("com.ric.Test")
Class cl = Test.class
Test test = new Test();
Class cl = test.getClass();
Class cl = ClassLoader.loadClass("com.ric.Test")
//åˆ©ç”¨åå°„åˆ›å»ºç±»,è°ƒç”¨é»˜è®¤å‚æ•°æ„é€ å™¨åˆ›å»ºå¯¹è±¡
Test test = cl.NewInstance()

```

### åˆ©ç”¨åå°„åˆ†æç±»çš„èƒ½åŠ›
- `getFields` `getDeclaredFields`
- `getMethods` `getDeclaredMethods`
- `getConstructors` `getDeclaredConstructors` 
- `setAccessible` ä¸¤ç§è°ƒç”¨æ–¹æ³•

## å¼‚å¸¸

![](https://hexoric-1310528773.cos.ap-beijing.myqcloud.com/hexo/guide4.png)

- å—æŸ¥å¼‚å¸¸`checkException` ç»¿è‰²  Java ä»£ç åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå—æ£€æŸ¥å¼‚å¸¸æ²¡æœ‰è¢« catch/throw å¤„ç†çš„è¯ï¼Œå°±æ²¡åŠæ³•é€šè¿‡ç¼–è¯‘ 
- éå—æŸ¥å¼‚å¸¸ `uncheckedException`  çº¢è‰² `RuntimeException` åŠå…¶å­ç±»éƒ½ç»Ÿç§°ä¸ºéå—æ£€æŸ¥å¼‚å¸¸  

### try catch finally
> ä¸è¦åœ¨ finally è¯­å¥å—ä¸­ä½¿ç”¨ return! å½“ try è¯­å¥å’Œ finally è¯­å¥ä¸­éƒ½æœ‰ return è¯­å¥æ—¶ï¼Œtry è¯­å¥å—ä¸­çš„ return è¯­å¥ä¼šè¢«å¿½ç•¥ã€‚è¿™æ˜¯å› ä¸º try è¯­å¥ä¸­çš„ return è¿”å›å€¼ä¼šå…ˆè¢«æš‚å­˜åœ¨ä¸€ä¸ªæœ¬åœ°å˜é‡ä¸­ï¼Œå½“æ‰§è¡Œåˆ° finally è¯­å¥ä¸­çš„ return ä¹‹åï¼Œè¿™ä¸ªæœ¬åœ°å˜é‡çš„å€¼å°±å˜ä¸ºäº† finally è¯­å¥ä¸­çš„ return è¿”å›å€¼

- `try-with-resources` ä»£æ›¿`try-catch-finally` å¯ä»¥çœç•¥finallyä¸­å…³é—­æµçš„æ–¹æ³•


## I/O

### åºåˆ—åŒ–
- åºåˆ—åŒ– : æ•°æ®ç»“æ„æˆ–å¯¹è±¡è½¬æ¢æˆäºŒè¿›åˆ¶å­—èŠ‚æµ
- ååºåˆ—åŒ–: 

> åºåˆ—åŒ–çš„ä¸»è¦ç›®çš„æ˜¯é€šè¿‡ç½‘ç»œä¼ è¾“å¯¹è±¡æˆ–è€…è¯´æ˜¯å°†å¯¹è±¡å­˜å‚¨åˆ°æ–‡ä»¶ç³»ç»Ÿã€æ•°æ®åº“ã€å†…å­˜ä¸­

> ä¸æƒ³è¿›è¡Œåºåˆ—åŒ–å¯ä»¥ä½¿ç”¨ `transient` å…³é”®å­—ä¿®é¥°
> åªèƒ½ä¿®é¥°å˜é‡,ä¿®é¥°çš„å˜é‡ åœ¨ååºåˆ—åŒ–åå˜é‡å€¼å°†ä¼šè¢«ç½®æˆç±»å‹çš„é»˜è®¤å€¼.å¦‚:int ç±»å‹ ååºåˆ—åŒ–åç»“æœå°±æ˜¯0(åŸå€¼ä¼šä¸¢å¤±)


### IOæµ
- æŒ‰ç…§æµæµå‘åˆ†,è¾“å…¥æµå’Œè¾“å‡ºæµ
- æŒ‰ç…§æ“ä½œå•å…ƒåˆ†,å­—èŠ‚æµå’Œå­—ç¬¦æµ

- `InputStream/Reader` è¾“å…¥æµçš„åŸºç±», `å­—èŠ‚/å­—ç¬¦`è¾“å…¥æµ
- `OutputStream/Writer` è¾“å‡ºæµçš„åŸºç±»,`å­—èŠ‚/å­—ç¬¦`è¾“å‡ºæµ

### æ—¢ç„¶æœ‰äº†å­—èŠ‚æµ,ä¸ºä»€ä¹ˆè¿˜è¦æœ‰å­—ç¬¦æµ
> ä¸ç®¡æ˜¯æ–‡ä»¶è¯»å†™è¿˜æ˜¯ç½‘ç»œå‘é€æ¥æ”¶ï¼Œä¿¡æ¯çš„æœ€å°å­˜å‚¨å•å…ƒéƒ½æ˜¯å­—èŠ‚ï¼Œé‚£ä¸ºä»€ä¹ˆ I/O æµæ“ä½œè¦åˆ†ä¸ºå­—èŠ‚æµæ“ä½œå’Œå­—ç¬¦æµæ“ä½œå‘¢?

> ç­”: å­—ç¬¦æµæ˜¯ç”±javaè™šæ‹Ÿæœºå°†å­—èŠ‚è½¬æ¢å¾—åˆ°çš„,è€Œè¿™ä¸ªè¿‡ç¨‹**éå¸¸è€—æ—¶,å®¹æ˜“ä¹±ç **,**éŸ³è§†é¢‘ç­‰åª’ä½“æ–‡ä»¶**ä½¿ç”¨å­—èŠ‚æµæ¯”è¾ƒå¥½,å­—ç¬¦ä½¿ç”¨å­—ç¬¦æµæ¯”è¾ƒå¥½


## é‡ç‚¹

### javaåªæœ‰å€¼ä¼ é€’?
Java ä¸­å°†å®å‚ä¼ é€’ç»™æ–¹æ³•ï¼ˆæˆ–å‡½æ•°ï¼‰çš„æ–¹å¼æ˜¯ **å€¼ä¼ é€’**:
- å¦‚æœå‚æ•°æ˜¯åŸºæœ¬ç±»å‹,ä¼ é€’çš„æ˜¯åŸºæœ¬ç±»å‹çš„å­—é¢é‡å€¼å¾—æ‹·è´,ä¼šåˆ›å»ºå‰¯æœ¬
- å¦‚æœå‚æ•°æ˜¯å¼•ç”¨ç±»å‹, ä¼ é€’å¾—æ˜¯å®å‚æ‰€å¼•ç”¨çš„å¯¹è±¡åœ¨å †ä¸­åœ°å€å€¼çš„æ‹·è´

### â­ğŸ’£IOæ¨¡å‹
å¾…  

### æµ®ç‚¹ç²¾åº¦ä¸¢å¤±é—®é¢˜
> æµ®ç‚¹æ•°ä¹‹é—´çš„ç­‰å€¼åˆ¤æ–­ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹ä¸èƒ½ç”¨==æ¥æ¯”è¾ƒï¼ŒåŒ…è£…æ•°æ®ç±»å‹ä¸èƒ½ç”¨ equals æ¥åˆ¤æ–­ 
> åˆ¤æ–­ç›¸ç­‰æ–¹æ³•: æŒ‡å®šè¯¯å·®èŒƒå›´,ä¸¤æ•°ç›¸å‡çš„ç»å¯¹å€¼`Math.abs()` å°äºè¯¯å·®èŒƒå›´ å¯ä»¥è®¤ä¸ºæ˜¯ç›¸ç­‰çš„ 

BigDecimal å¸¸è§æ–¹æ³•
- `add`
- `subtract`
- `multiply`
- `divide` 
- `compareTo()`
- `setScale(3,RoundingMode.HALF_UP)` ä¿ç•™ä¸‰ä½å°æ•°å››èˆäº”å…¥

> ç¦æ­¢ä½¿ç”¨`new BigDecimal(double)` æ„é€  `BigDecimal` å¯¹è±¡,æ¨èä½¿ç”¨`Stringæ„é€ `æˆ–è€… `BigDecimal.valueOf()`




# â­ å®¹å™¨  
![](https://gitee.com/riiicc/JavaCoreTech/raw/master/part9/photo/p914-1.png)

## é›†åˆæ¦‚è§ˆ
 - `Collection` æ¥å£
   - `List` `Set` `Queue` 
 - `Map` æ¥å£

## List, Set, Queue, Map å››è€…çš„åŒºåˆ«
- `List` æœ‰åºå¯é‡å¤
- `Set` æ— åºä¸å¯é‡å¤
- `Queue` æœ‰åºå¯é‡å¤,é˜Ÿåˆ—é¡ºåº
- `Map` é”®å€¼å­˜å‚¨,æ— åº key ä¸å¯é‡å¤,value å¯é‡å¤

## List
- `ArrayList` : `Object []`æ•°ç»„å®ç° æŸ¥è¯¢å¿« çº¿ç¨‹ä¸å®‰å…¨
- `Vector` : `Object []`æ•°ç»„å®ç°,çº¿ç¨‹å®‰å…¨
- `LinkedList` : åŒå‘é“¾è¡¨ å¢åˆ å¿« çº¿ç¨‹ä¸å®‰å…¨

> LinedList ä¹Ÿæœ‰éšæœºè®¿é—®æ–¹æ³•,åªä¸è¿‡æ•ˆç‡å¾ˆä½,æ²¡æœ‰å®ç° `RandomAccess` ,ä½†æ˜¯å¯ä»¥ç”¨getæ–¹æ³•è·å–å…ƒç´ 
> åˆ¤æ–­æ˜¯å¦æ”¯æŒéšæœºè®¿é—® `list instanceof RandomAccess`

## Set
å…¨éƒ¨çº¿ç¨‹ä¸å®‰å…¨
- `HashSet` æ— åº å”¯ä¸€,åŸºäºhashMap åº•å±‚é‡‡ç”¨HashMap (å“ˆå¸Œè¡¨)
- `LinkedHashSet` : æœ‰åº å”¯ä¸€ HashSetçš„å­ç±», å†…éƒ¨é€šè¿‡ LinkedHashMapå®ç°, (é“¾è¡¨,å“ˆå¸Œè¡¨)
- `TreeSet` æœ‰åºå”¯ä¸€,çº¢é»‘æ ‘ 

### HashSet æŸ¥é‡
> å½“ä½ æŠŠå¯¹è±¡åŠ å…¥HashSetæ—¶ï¼ŒHashSet ä¼šå…ˆè®¡ç®—å¯¹è±¡çš„hashcodeå€¼æ¥åˆ¤æ–­å¯¹è±¡åŠ å…¥çš„ä½ç½®ï¼Œ
> åŒæ—¶ä¹Ÿä¼šä¸å…¶ä»–åŠ å…¥çš„å¯¹è±¡çš„ hashcode å€¼ä½œæ¯”è¾ƒï¼Œå¦‚æœæ²¡æœ‰ç›¸ç¬¦çš„ hashcodeï¼ŒHashSet ä¼šå‡è®¾å¯¹è±¡æ²¡æœ‰é‡å¤å‡ºç°ã€‚
> ä½†æ˜¯å¦‚æœå‘ç°æœ‰ç›¸åŒ hashcode å€¼çš„å¯¹è±¡ï¼Œè¿™æ—¶ä¼šè°ƒç”¨equals()æ–¹æ³•æ¥æ£€æŸ¥ hashcode ç›¸ç­‰çš„å¯¹è±¡æ˜¯å¦çœŸçš„ç›¸åŒã€‚å¦‚æœä¸¤è€…ç›¸åŒï¼ŒHashSet å°±ä¸ä¼šè®©åŠ å…¥æ“ä½œæˆåŠŸ

## Queue
- `PriorityQueue` `Object []` æ•°ç»„æ¥å®ç°äºŒå‰å †
- `ArrayQueue` `Object []`

## Map
- `HashMap` éåŒæ­¥,
- `LinkedHashMap` ç»§æ‰¿è‡ª `HashMap` 
- `HashTable` æ•°ç»„+é“¾è¡¨ åŒæ­¥
- `TreeMap` çº¢é»‘æ ‘

> Map çš„ä¸‰ç§è§†å›¾ `entrySet` `keySet` `values`

### HashMap
> `HashMap` å¯ä»¥å­˜å‚¨ null çš„ key å’Œ valueï¼Œä½† null ä½œä¸ºé”®åªèƒ½æœ‰ä¸€ä¸ªï¼Œnull ä½œä¸ºå€¼å¯ä»¥æœ‰å¤šä¸ªï¼›  
> `Hashtable` ä¸å…è®¸æœ‰ null é”®å’Œ null å€¼ï¼Œå¦åˆ™ä¼šæŠ›å‡º `NullPointerException`  
> `HashMap` é»˜è®¤çš„åˆå§‹åŒ–å¤§å°ä¸º 16ã€‚ä¹‹åæ¯æ¬¡æ‰©å……ï¼Œå®¹é‡å˜ä¸ºåŸæ¥çš„ 2 å€    

> HashMap å¤šçº¿ç¨‹æ“ä½œå¯¼è‡´æ­»å¾ªç¯,ä¸å»ºè®®åœ¨å¤šçº¿ç¨‹ä¸‹ä½¿ç”¨ HashMap,å› ä¸ºå¤šçº¿ç¨‹ä¸‹ä½¿ç”¨ HashMap è¿˜æ˜¯ä¼šå­˜åœ¨å…¶ä»–é—®é¢˜æ¯”å¦‚æ•°æ®ä¸¢å¤±ã€‚
> å¤šçº¿ç¨‹ä¸‹åº”è¯¥ä½¿ç”¨`ConcurrentHashMap`

### HashMapéå†
- `map.entrySet().iterator()`
- `map.keySet().iterator()`
- `for (Map.Entry<Integer, String> entry : map.entrySet())`
- `for (Integer key : map.keySet())`
- `map.forEach((key, value) -> {});`
- `map.entrySet().stream().forEach()`
- `map.keySet().stream().forEach()`

## comparable  Comparator 
- `comparable` æ¥å£ åŒ…å«compareTo æ–¹æ³•è¿›è¡Œæ’åº,ä¸€èˆ¬å®ç°æ¥å£é‡å†™compareToæ–¹æ³•è¿›è¡Œè‡ªå®šä¹‰æ’åº
- `Comparator` æ¥å£ æ¯”è¾ƒå™¨,ä¸€èˆ¬é€šè¿‡åŒ¿åç±»æ–¹å¼å®šä¹‰ä¸€ä¸ªæ¯”è¾ƒè§„åˆ™,é…åˆ`Collections.sort()`


## æ— åºæ€§å’Œä¸å¯é‡å¤æ€§çš„å«ä¹‰æ˜¯ä»€ä¹ˆ

- æ— åºæ€§!= éšæœº æ— åºæŒ‰ç…§æ•°æ®å“ˆå¸Œå€¼å†³å®š
- ä¸å¯é‡å¤ equals åˆ¤æ–­è¿”å›false (åŒæ—¶é‡å†™equals å’Œhashcode)

## Collections å·¥å…·ç±»

### æ’åº
```java
void reverse(List list)//åè½¬
void shuffle(List list)//éšæœºæ’åº
void sort(List list)//æŒ‰è‡ªç„¶æ’åºçš„å‡åºæ’åº
void sort(List list, Comparator c)//å®šåˆ¶æ’åºï¼Œç”±Comparatoræ§åˆ¶æ’åºé€»è¾‘
void swap(List list, int i , int j)//äº¤æ¢ä¸¤ä¸ªç´¢å¼•ä½ç½®çš„å…ƒç´ 
void rotate(List list, int distance)//æ—‹è½¬ã€‚å½“distanceä¸ºæ­£æ•°æ—¶ï¼Œå°†listådistanceä¸ªå…ƒç´ æ•´ä½“ç§»åˆ°å‰é¢ã€‚å½“distanceä¸ºè´Ÿæ•°æ—¶ï¼Œå°† listçš„å‰distanceä¸ªå…ƒç´ æ•´ä½“ç§»åˆ°åé¢

```

### åŒæ­¥è§†å›¾
```java
synchronizedCollection(Collection<T>  c) //è¿”å›æŒ‡å®š collection æ”¯æŒçš„åŒæ­¥ï¼ˆçº¿ç¨‹å®‰å…¨çš„ï¼‰collectionã€‚
synchronizedList(List<T> list)//è¿”å›æŒ‡å®šåˆ—è¡¨æ”¯æŒçš„åŒæ­¥ï¼ˆçº¿ç¨‹å®‰å…¨çš„ï¼‰Listã€‚
synchronizedMap(Map<K,V> m) //è¿”å›ç”±æŒ‡å®šæ˜ å°„æ”¯æŒçš„åŒæ­¥ï¼ˆçº¿ç¨‹å®‰å…¨çš„ï¼‰Mapã€‚
synchronizedSet(Set<T> s) //è¿”å›æŒ‡å®š set æ”¯æŒçš„åŒæ­¥ï¼ˆçº¿ç¨‹å®‰å…¨çš„ï¼‰setã€‚
```
## é›†åˆä½¿ç”¨æ³¨æ„äº‹é¡¹


### é›†åˆåˆ¤ç©º
> åˆ¤æ–­æ‰€æœ‰é›†åˆå†…éƒ¨çš„å…ƒç´ æ˜¯å¦ä¸ºç©ºï¼Œä½¿ç”¨ `isEmpty()` æ–¹æ³•ï¼Œè€Œä¸æ˜¯ `size()==0` çš„æ–¹å¼
> å› ä¸º `isEmpty()` æ–¹æ³•çš„å¯è¯»æ€§æ›´å¥½ï¼Œå¹¶ä¸”æ—¶é—´å¤æ‚åº¦ä¸º `O(1)`
> size() æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ `O(1)`ï¼Œä¸è¿‡ï¼Œä¹Ÿæœ‰å¾ˆå¤šå¤æ‚åº¦ä¸æ˜¯ `O(1)` çš„ï¼Œæ¯”å¦‚ `java.util.concurrent` åŒ…ä¸‹çš„æŸäº›é›†åˆ`ConcurrentLinkedQueue` ã€`ConcurrentHashMap`

### å¯¹è±¡é›†åˆè½¬Map
> åœ¨ä½¿ç”¨ `java.util.stream.Collectors` ç±»çš„ `toMap()` æ–¹æ³•è½¬ä¸º Map é›†åˆæ—¶ï¼Œä¸€å®šè¦æ³¨æ„å½“ value ä¸º null æ—¶ä¼šæŠ› NPE å¼‚å¸¸
> å› ä¸º `toMap()` æ–¹æ³• ï¼Œå…¶å†…éƒ¨è°ƒç”¨äº† Map æ¥å£çš„ `merge()` æ–¹æ³•,`merge()` æ–¹æ³•ä¼šå…ˆè°ƒç”¨ `Objects.requireNonNull()` æ–¹æ³•åˆ¤æ–­ value æ˜¯å¦ä¸ºç©º


### é›†åˆéå†
> ä¸è¦åœ¨ foreach å¾ªç¯é‡Œè¿›è¡Œå…ƒç´ çš„ `remove/add` æ“ä½œã€‚remove å…ƒç´ è¯·ä½¿ç”¨ Iterator æ–¹å¼ï¼Œå¦‚æœå¹¶å‘æ“ä½œï¼Œéœ€è¦å¯¹ Iterator å¯¹è±¡åŠ é”
> Java8 å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨ `Collection#removeIf()`æ–¹æ³•åˆ é™¤æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„å…ƒç´ 


### æ•°ç»„è½¬é›†åˆ
> ä½¿ç”¨å·¥å…·ç±» `Arrays.asList()` æŠŠæ•°ç»„è½¬æ¢æˆé›†åˆæ—¶ï¼Œä¸èƒ½ä½¿ç”¨å…¶ä¿®æ”¹é›†åˆç›¸å…³çš„æ–¹æ³•ï¼Œ å®ƒçš„ `add/remove/clear` æ–¹æ³•ä¼šæŠ›å‡º `UnsupportedOperationException` å¼‚å¸¸
> `Arrays.asList()` æ–¹æ³•è¿”å›çš„å¹¶ä¸æ˜¯ `java.util.ArrayList` ï¼Œè€Œæ˜¯ `java.util.Arrays` çš„ä¸€ä¸ªå†…éƒ¨ç±»,è¿™ä¸ªå†…éƒ¨ç±»å¹¶æ²¡æœ‰å®ç°é›†åˆçš„ä¿®æ”¹æ–¹æ³•æˆ–è€…è¯´å¹¶æ²¡æœ‰é‡å†™è¿™äº›æ–¹æ³•

```java
List myList = Arrays.stream(myArray2).boxed().collect(Collectors.toList());
```

## ä¸ºä»€ä¹ˆæ˜¯é¢å‘æ¥å£ç¼–ç¨‹   
`List<Object> objects = new ArrayList<>()`
https://stackoverflow.com/questions/17059139/listobject-listobject-new-arraylistobject  

> æ ¸å¿ƒ: é¢å‘æ¥å£ç¼–ç¨‹  ç¨‹åºæŒ‡å‘æ¥å£ï¼Œè€Œä¸æ˜¯å®ç°(Programming to an interface, not to an implementation)
> ä½¿ç”¨ `List` åç»­ä¿®æ”¹ä»£ç è­¬å¦‚æ”¹æˆLinkedList ä¸ä¼šå¯¹æ—§ä»£ç æœ‰å½±å“( breaking the rest of the code )


# â­å¹¶å‘  
## çº¿ç¨‹å’Œè¿›ç¨‹  
- è¿›ç¨‹ï¼šæ“ä½œç³»ç»Ÿçš„å¹¶å‘,è¿›ç¨‹é—´é€šä¿¡å¤æ‚,é‡é‡çº§
- çº¿ç¨‹ï¼šè¿›ç¨‹å†…éƒ¨å¹¶å‘,çº¿ç¨‹é—´é€šä¿¡ç®€å•,è½»é‡çº§

> æœ¬è´¨åŒºåˆ«ï¼š æ˜¯å¦å•ç‹¬å æœ‰å†…å­˜åœ°å€ç©ºé—´åŠå…¶ä»–ç³»ç»Ÿèµ„æº(I/O)  
> è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½,  
> çº¿ç¨‹æ˜¯ç³»ç»Ÿè¿›è¡Œè°ƒåº¦(cpuæ—¶é—´ç‰‡åˆ†é…)çš„åŸºæœ¬å•ä½

## çº¿ç¨‹éš”ç¦»çš„å†…å­˜æ•°æ®åŒº
- javaæ ˆ :Javaæ–¹æ³•æ‰§è¡Œçš„çº¿ç¨‹å†…å­˜æ¨¡å‹,æ ˆå¸§ å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€è¿æ¥ã€æ–¹æ³•å‡ºå£
- æœ¬åœ°æ–¹æ³•æ ˆ: JVM è¿è¡Œ Native æ–¹æ³•å‡†å¤‡çš„ç©ºé—´
- ç¨‹åºè®¡æ•°å™¨ :è®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ä½ç½®,æ˜¯æè¿°æœ¬åœ°æ–¹æ³•è¿è¡Œè¿‡ç¨‹çš„å†…å­˜æ¨¡å‹


## å¹¶å‘å¹¶è¡Œçš„åŒºåˆ«
- å¹¶å‘ :åŒä¸€æ—¶é—´æ®µ,å¤šä¸ªä»»åŠ¡éƒ½åœ¨æ‰§è¡Œ
- å¹¶è¡Œ: å•ä½æ—¶é—´å†…,å¤šä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œ

## å¤šçº¿ç¨‹å¸¦æ¥çš„é—®é¢˜
å†…å­˜æ³„æ¼,æ­»é”,çº¿ç¨‹å®‰å…¨é—®é¢˜ç­‰

## çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå’ŒçŠ¶æ€
å…­ç§çŠ¶æ€:  
- `NEW` çº¿ç¨‹åˆ›å»º,æœªè°ƒç”¨ `start` æ–¹æ³•
- `RUNNABLE` è¡¨ç¤ºå½“å‰çº¿ç¨‹æ­£åœ¨è¿è¡Œä¸­ã€‚å¤„äºRUNNABLEçŠ¶æ€çš„çº¿ç¨‹åœ¨Javaè™šæ‹Ÿæœºä¸­è¿è¡Œï¼Œä¹Ÿæœ‰å¯èƒ½åœ¨ç­‰å¾…å…¶ä»–ç³»ç»Ÿèµ„æºï¼ˆæ¯”å¦‚I/Oï¼‰
- `BLOCKED` é˜»å¡
- `WAITING` ç­‰å¾… `wait()`
- `TIMED_WAITING` è®¡æ—¶ç­‰å¾… `sleep(long millis)` `wait(long millis)`
- `TERMINATED`

> çº¿ç¨‹åˆ›å»ºä¹‹åå®ƒå°†å¤„äº NEWï¼ˆæ–°å»ºï¼‰ çŠ¶æ€ï¼Œè°ƒç”¨ start() æ–¹æ³•åå¼€å§‹è¿è¡Œï¼Œçº¿ç¨‹è¿™æ—¶å€™å¤„äº READYï¼ˆå¯è¿è¡Œï¼‰ çŠ¶æ€ã€‚å¯è¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹è·å¾—äº† CPU æ—¶é—´ç‰‡ï¼ˆtimesliceï¼‰åå°±å¤„äº RUNNINGï¼ˆè¿è¡Œï¼‰ çŠ¶æ€
## çº¿ç¨‹çŠ¶æ€åˆ‡æ¢
![](https://hexoric-1310528773.cos.ap-beijing.myqcloud.com/hexo/åŸºç¡€12.png)


## ä¸Šä¸‹æ–‡åˆ‡æ¢
> çº¿ç¨‹åˆ‡æ¢æ„å‘³ç€éœ€è¦ä¿å­˜å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œç•™å¾…çº¿ç¨‹ä¸‹æ¬¡å ç”¨ CPU çš„æ—¶å€™æ¢å¤ç°åœºã€‚å¹¶åŠ è½½ä¸‹ä¸€ä¸ªå°†è¦å ç”¨ CPU çš„çº¿ç¨‹ä¸Šä¸‹æ–‡ã€‚è¿™å°±æ˜¯æ‰€è°“çš„ ä¸Šä¸‹æ–‡åˆ‡æ¢

å‡ºç°ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æƒ…å†µ:  
- `sleep(),wait()`
- ç³»ç»Ÿåˆ†é…çš„æ—¶é—´ç‰‡ç”¨å®Œ
- çº¿ç¨‹è¢«é˜»å¡
- è¿è¡Œç»“æŸ

## æ­»é”  

```java
public class DeadLock {

    static Object a = new Object();
    static Object b = new Object();

    public static void main(String[] args) {
        new Thread(()->{
            synchronized (a){
                System.out.println(Thread.currentThread().getName()+"æŒæœ‰aè¯•å›¾è·å–b");
                try {
                    TimeUnit.SECONDS.sleep(1);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
                synchronized (b){
                    System.out.println(Thread.currentThread().getName()+"è·å–b");
                }
            }
        },"aa").start();

        new Thread(()->{
            synchronized (b){
                System.out.println(Thread.currentThread().getName()+"æŒæœ‰bè¯•å›¾è·å–a");
                try {
                    TimeUnit.SECONDS.sleep(1);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
                synchronized (a){
                    System.out.println(Thread.currentThread().getName()+"è·å–a");
                }
            }
        },"bb").start();
    }
}
```


## sleep å’ŒwaitåŒºåˆ«
- sleep ä¸ä¼šé‡Šæ”¾é”,waité‡Šæ”¾é”
- waitç”¨äºçº¿ç¨‹é—´äº¤äº’é€šä¿¡,sleepåŒäºæš‚åœæ‰§è¡Œ
- wait éœ€è¦ notify æ¢å¤æˆ–è€…å®šæ—¶æ¢å¤(æŒ‡å®šæ—¶é•¿),sleep è‡ªåŠ¨è‹é†’

## ä¸ºä»€ä¹ˆä¸ç›´æ¥è°ƒç”¨runæ–¹æ³•
>è°ƒç”¨ start() æ–¹æ³•æ–¹å¯å¯åŠ¨çº¿ç¨‹å¹¶ä½¿çº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œç›´æ¥æ‰§è¡Œ run() æ–¹æ³•çš„è¯ä¸ä¼šä»¥å¤šçº¿ç¨‹çš„æ–¹å¼æ‰§è¡Œ

## synchronized å…³é”®å­—

### ç†è§£
è§£å†³å¤šçº¿ç¨‹é—´è®¿é—®èµ„æºçš„åŒæ­¥é—®é¢˜,å¯ä»¥ä¿è¯è¢«å®ƒä¿®é¥°çš„æ–¹æ³•æˆ–è€…ä»£ç å—,åœ¨ä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ.

### ä½¿ç”¨
- ä¿®é¥°å®ä¾‹æ–¹æ³•,ä½œç”¨åŸŸå½“å‰å¯¹è±¡å®ä¾‹`synchronized void method()`
- ä¿®é¥°é™æ€æ–¹æ³•,ä½œç”¨ä¸ç±»`synchronized static void method()`
- ä¿®é¥°ä»£ç å—,`synchronized(this|object)` è¡¨ç¤ºè¿›å…¥åŒæ­¥ä»£ç åº“å‰è¦è·å¾—ç»™å®šå¯¹è±¡çš„é”ã€‚`synchronized(ç±».class) `è¡¨ç¤ºè¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾— å½“å‰ class çš„é”

### åŒé‡æ ¡éªŒé”å®ç°å¯¹è±¡å•ä¾‹
```java
public class Singleton {

    private volatile static Singleton uniqueInstance;

    private Singleton() {
    }

    public  static Singleton getUniqueInstance() {
       //å…ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦å·²ç»å®ä¾‹è¿‡ï¼Œæ²¡æœ‰å®ä¾‹åŒ–è¿‡æ‰è¿›å…¥åŠ é”ä»£ç 
        if (uniqueInstance == null) {
            //ç±»å¯¹è±¡åŠ é”
            synchronized (Singleton.class) {
                if (uniqueInstance == null) {
                    uniqueInstance = new Singleton();
                }
            }
        }
        return uniqueInstance;
    }
}

```
### JDK1.6 ä¹‹åçš„ synchronized å…³é”®å­—åº•å±‚åšäº†å“ªäº›ä¼˜åŒ–
Java 6 åŠå…¶ä»¥åï¼Œä¸€ä¸ªå¯¹è±¡å…¶å®æœ‰å››ç§é”çŠ¶æ€ï¼Œå®ƒä»¬çº§åˆ«ç”±ä½åˆ°é«˜ä¾æ¬¡æ˜¯:   
- æ— é”çŠ¶æ€
- åå‘é”çŠ¶æ€
- è½»é‡çº§é”çŠ¶æ€
- é‡é‡çº§é”çŠ¶æ€

### synchronized å’Œ ReentrantLock çš„åŒºåˆ«
- `synchronized` ä¾èµ–äº JVM è€Œ `ReentrantLock` ä¾èµ–äº API
- `ReentrantLock` æ¯” `synchronized` å¢åŠ äº†ä¸€äº›é«˜çº§åŠŸèƒ½
    - å…¬å¹³é”
    - `Condition` é€šçŸ¥


## volatile å…³é”®å­—

volatile å…³é”®å­—ä¸»è¦åŠŸèƒ½:  
- ä¿è¯å˜é‡çš„**å†…å­˜å¯è§æ€§** 
- ç¦æ­¢volatile å˜é‡ä¸æ™®é€šå˜é‡**é‡æ’åº**

> å†…å­˜å¯è§æ€§: çº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§,å½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡æ—¶(ä¼šç«‹å³å°†å˜é‡å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜),å¦ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¯»å–åˆ°è¿™ä¸ªä¿®æ”¹åçš„å€¼

> é‡æ’åº: ä¸ºä¼˜åŒ–ç¨‹åºæ€§èƒ½ï¼Œå¯¹åŸæœ‰çš„æŒ‡ä»¤æ‰§è¡Œé¡ºåºè¿›è¡Œä¼˜åŒ–é‡æ–°æ’åºã€‚é‡æ’åºå¯èƒ½å‘ç”Ÿåœ¨å¤šä¸ªé˜¶æ®µï¼Œæ¯”å¦‚ç¼–è¯‘é‡æ’åºã€CPUé‡æ’åºç­‰


## JMM java å†…å­˜æ¨¡å‹
> JMM æŠ½è±¡äº†çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„å…³ç³»,JMMæœ‰å¦‚ä¸‹ç‰¹ç‚¹:

- æ‰€æœ‰çš„å…±äº«å˜é‡(å¦‚volatile ä¿®é¥°çš„)éƒ½å­˜åœ¨ä¸»å†…å­˜ä¸­
- æ¯ä¸ªçº¿ç¨‹éƒ½ä¿å­˜äº†ä¸€ä»½è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å…±äº«å˜é‡çš„å‰¯æœ¬
- å¦‚æœçº¿ç¨‹Aå’Œçº¿ç¨‹Bä¹‹é—´é€šä¿¡å¿…é¡»ç»å†å¦‚ä¸‹2ä¸ªæ­¥éª¤
  - çº¿ç¨‹Aå°†æœ¬åœ°å†…å­˜Aæ›´æ–°è¿‡çš„å…±äº«ä¾¿ä»¤åˆ·æ–°åˆ°ä¸»å†…å­˜å»
  - çº¿ç¨‹Båˆ°ä¸»å†…å­˜ä¸­è¯»å–çº¿ç¨‹Aä¹‹å‰å·²ç»æ›´æ–°è¿‡çš„å…±äº«å˜é‡

> æ³¨æ„: çº¿ç¨‹Aæ— æ³•ç›´æ¥è®¿é—®çº¿ç¨‹Bçš„å·¥ä½œå†…å­˜,çº¿ç¨‹é—´é€šä¿¡å¿…é¡»ç»è¿‡ä¸»å†…å­˜
> çº¿ç¨‹å¯¹å…±äº«å˜é‡çš„æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»åœ¨è‡ªå·±çš„æœ¬åœ°å†…å­˜ä¸­è¿›è¡Œ,ä¸èƒ½ç›´æ¥ä»ä¸»å†…å­˜ä¸­è¯»å–
> JMMé€šè¿‡æ§åˆ¶ä¸»å†…å­˜ä¸æ¯ä¸ªçº¿ç¨‹çš„æœ¬åœ°å†…å­˜ä¹‹é—´çš„äº¤äº’,æ¥æä¾›å†…å­˜å¯è§æ€§çš„ä¿è¯

## å¹¶å‘ç¼–ç¨‹çš„ä¸‰ä¸ªé‡è¦ç‰¹æ€§
- åŸå­æ€§: `synchronized` å¯ä»¥ä¿è¯ä»£ç ç‰‡æ®µçš„åŸå­æ€§
- å¯è§æ€§: `volatile` ä¿è¯å†…å­˜å¯è§æ€§
- æœ‰åºæ€§: `volatile` ç¦æ­¢æŒ‡ä»¤é‡æ’åº

## synchronized å…³é”®å­—å’Œ volatile å…³é”®å­—çš„åŒºåˆ«

- `synchronized` å¯ä»¥ä¿®é¥°ä»£ç å—å’Œæ–¹æ³•,èƒ½ä¿è¯å¯è§æ€§å’ŒåŸå­æ€§,ç”¨äºå¤šçº¿ç¨‹è®¿é—®èµ„æºåŒæ­¥
- `volatile` åªèƒ½ä¿®é¥°å˜é‡,èƒ½ä¿è¯å¯è§æ€§ä¸èƒ½ä¿è¯åŸå­æ€§,ç”¨äºå¤šçº¿ç¨‹é—´å˜é‡çš„å¯è§


## ThreadLocal
> ThreadLocalæ˜¯ä¸€ä¸ªæœ¬åœ°çº¿ç¨‹å‰¯æœ¬å˜é‡å·¥å…·ç±»ã€‚å†…éƒ¨æ˜¯ä¸€ä¸ªå¼±å¼•ç”¨çš„Mapæ¥ç»´æŠ¤

> æœ€å¸¸è§çš„ThreadLocalä½¿ç”¨åœºæ™¯ä¸ºç”¨æ¥è§£å†³æ•°æ®åº“è¿æ¥ã€Sessionç®¡ç†ç­‰ã€‚æ•°æ®åº“è¿æ¥å’ŒSessionç®¡ç†æ¶‰åŠå¤šä¸ªå¤æ‚å¯¹è±¡çš„åˆå§‹åŒ–å’Œå…³é—­
## çº¿ç¨‹æ± 
å¥½å¤„:  
- é™ä½èµ„æºæ¶ˆè€—,çº¿ç¨‹å¤ç”¨
- **æ§åˆ¶å¹¶å‘æ•°é‡**
- æ–¹ä¾¿çº¿ç¨‹çš„ç»Ÿä¸€ç®¡ç†

### Runnable Callable
> `Runnable` ä¸ä¼šè¿”å›ç»“æœ,ä¸ä¼šæŠ›å‡ºæ£€æŸ¥å¼‚å¸¸( `Callable` å¯ä»¥)
> å·¥å…·ç±» `Executors` å¯ä»¥å°† `Runnable` å¯¹è±¡è½¬ä¸º `Callable` å¯¹è±¡  
> `Executors.callable(Runnable task)`
> `Executors.callable(Runnable task, Object result)`

### execute()æ–¹æ³•å’Œ submit()æ–¹æ³•çš„åŒºåˆ«
- `execute()` ç”¨äºæäº¤ä¸éœ€è¦è¿”å›å€¼çš„ä»»åŠ¡,æ— æ³•åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸ
- `submit()` ç”¨äºéœ€è¦è¿”å›å€¼çš„ä»»åŠ¡,çº¿ç¨‹æ± ä¼šè¿”å›ä¸€ä¸ªFuture å¯¹è±¡ å¯ä»¥åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æˆåŠŸ,è·å–è¿”å›å€¼

### åˆ›å»ºçº¿ç¨‹æ± 
- `Executors.newFixedThreadPool(int)` å›ºå®šæ•°é‡çš„çº¿ç¨‹
- `Executors.newSingleThreadExecutor()` åªæœ‰ä¸€ä¸ªçº¿ç¨‹,é¡ºåºæ‰§è¡Œ
- `Executors.newCachedThreadPool()` å¯æ‰©å®¹çš„çº¿ç¨‹æ± ,ç©ºé—²çº¿ç¨‹é»˜è®¤ä¿ç•™60s

**ä¸Šè¿°çº¿ç¨‹æ± åˆ›å»ºéƒ½æ˜¯ç”¨`ThreadPoolExecutor()æ–¹æ³•` æ­é…ä¸åŒå‚æ•°è¿›è¡Œåˆ›å»º**  
**ä¸å»ºè®®ä½¿ç”¨ä¸Šè¿°æ–¹æ³•åˆ›å»ºçº¿ç¨‹æ± ,å»ºè®®é€šè¿‡`ThreadPoolExecutor()`æ„é€ æ–¹æ³•è‡ªå®šåˆ›å»ºçº¿ç¨‹æ± **


## AtomicåŸå­ç±»  
> åŸå­ç±»è¯´ç®€å•ç‚¹å°±æ˜¯å…·æœ‰åŸå­/åŸå­æ“ä½œç‰¹å¾çš„ç±»  
> å¹¶å‘åŒ… `java.util.concurrent` çš„åŸå­ç±»éƒ½å­˜æ”¾åœ¨ `java.util.concurrent.atomic`
### CAS
> CASå…¨ç§°:æ¯”è¾ƒå¹¶äº¤æ¢ (compare and swap)  
> Java ä¸­é€šè¿‡ `Unsafe` ç±»æ¥å®ç°CASåŸç†

### åŸå­ç±»
- åŸºæœ¬ç±»å‹ `AtomicInteger` `AtomicLong` `AtomicBoolean`
- æ•°ç»„ç±»å‹ `AtomicIntegerArray` `AtomicLongArray` `AtomicReferenceArray`
- å¼•ç”¨ç±»å‹ `AtomicReference` `AtomicStampedReference` 
- ...

### AtomicInteger
```java
public final int get() //è·å–å½“å‰çš„å€¼
public final int getAndSet(int newValue)//è·å–å½“å‰çš„å€¼ï¼Œå¹¶è®¾ç½®æ–°çš„å€¼
public final int getAndIncrement()//è·å–å½“å‰çš„å€¼ï¼Œå¹¶è‡ªå¢
public final int getAndDecrement() //è·å–å½“å‰çš„å€¼ï¼Œå¹¶è‡ªå‡
public final int getAndAdd(int delta) //è·å–å½“å‰çš„å€¼ï¼Œå¹¶åŠ ä¸Šé¢„æœŸçš„å€¼
boolean compareAndSet(int expect, int update) //å¦‚æœè¾“å…¥çš„æ•°å€¼ç­‰äºé¢„æœŸå€¼ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†è¯¥å€¼è®¾ç½®ä¸ºè¾“å…¥å€¼ï¼ˆupdateï¼‰
public final void lazySet(int newValue)//æœ€ç»ˆè®¾ç½®ä¸ºnewValue,ä½¿ç”¨ lazySet è®¾ç½®ä¹‹åå¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹åœ¨ä¹‹åçš„ä¸€å°æ®µæ—¶é—´å†…è¿˜æ˜¯å¯ä»¥è¯»åˆ°æ—§çš„å€¼ã€‚

```

## AQS
> AQSæ˜¯ `AbstractQueuedSynchronizer` çš„ç®€ç§°ï¼Œå³**æŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨**,ç±»åœ¨ `java.util.concurrent.locks` åŒ…ä¸‹é¢
> `ReentrantLock``ï¼ŒSemaphore` ï¼Œ`ReentrantReadWriteLock`ï¼Œ`SynchronousQueue`ï¼Œ`FutureTask`ç­‰ç­‰çš†æ˜¯åŸºäºAQS

### åŸç†
å¾…ç†è§£

### AQS å®šä¹‰ä¸¤ç§èµ„æºçš„å…±äº«æ–¹å¼
- `Exclusive` ç‹¬å : åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œ,å¦‚ `ReentrantLock` 
  - å…¬å¹³é”
  - éå…¬å¹³é”
- `Share` å…±äº«:å¤šçº¿ç¨‹å¯ä»¥åŒæ—¶æ‰§è¡Œ å¦‚ `CountDownLatch` `Semapore` `CyclicBarrier` è¯»å†™é”(è¯»å¯`new ReentrantReadWriteLock().readLock()`ä»¥çœ‹ä½œå…±äº«,å†™`writeLock()`å¯ä»¥çœ‹ä½œç‹¬å )

### å…³äºAQSç»„ä»¶
`CountDownLatch` `Semapore` `CyclicBarrier` 

è¯¦è§JUCæ–‡æ¡£    
[jucçš„è¾…åŠ©ç±»](Java/JUCå¼€å‘?id=jucçš„è¾…åŠ©ç±»)  

# JVM


# æ–°ç‰¹æ€§









# Spring

## æ¨¡å—
> `Spring Core` `Spring Aspects` `Spring AOP` `Spring Data` `Spring Web` 

## IOC AOP
> `IoC (inverse of control) `æ§åˆ¶åè½¬,ä¸€ç§è®¾è®¡æ€æƒ³, å°†å¯¹è±¡åˆ›å»ºå’Œç®¡ç†çš„æƒåŠ›äº¤ç»™Spring   
> å°†å¯¹è±¡ä¹‹é—´çš„ç›¸äº’ä¾èµ–å…³ç³»äº¤ç»™ IoC å®¹å™¨æ¥ç®¡ç†ï¼Œå¹¶ç”± IoC å®¹å™¨å®Œæˆå¯¹è±¡çš„æ³¨å…¥ã€‚è¿™æ ·å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šç®€åŒ–åº”ç”¨çš„å¼€å‘
> åªéœ€è¦ä½¿ç”¨é…ç½®æ–‡ä»¶æˆ–è€…æ³¨è§£é…ç½®,ä¸ç”¨è€ƒè™‘å¯¹è±¡å¦‚ä½•åˆ›å»º 
>  IoC å®¹å™¨æ˜¯ Spring ç”¨æ¥å®ç° IoC çš„è½½ä½“ï¼Œ IoC å®¹å™¨å®é™…ä¸Šå°±æ˜¯ä¸ª Mapï¼ˆkeyï¼Œvalueï¼‰ï¼ŒMap ä¸­å­˜æ”¾çš„æ˜¯å„ç§å¯¹è±¡


> `AOP(Aspect-Oriented Programming:é¢å‘åˆ‡é¢ç¼–ç¨‹)` 
> å‡å°‘é‡å¤ä»£ç ,é™ä½è€¦åˆ
> åŸºäºåŠ¨æ€ä»£ç†,å¦‚æœä»£ç†å¯¹è±¡å®ç°äº†æŸä¸ªæ¥å£,Spring AOPä¼šä½¿ç”¨JDK Proxy, æ²¡æœ‰å®ç°æ¥å£çš„å¯¹è±¡ä½¿ç”¨ Cglib 


## Spring AOP å’Œ AspectJ AOP æœ‰ä»€ä¹ˆåŒºåˆ«
Spring AOP å±äºè¿è¡Œæ—¶å¢å¼ºï¼Œè€Œ AspectJ æ˜¯ç¼–è¯‘æ—¶å¢å¼ºã€‚ Spring AOP åŸºäºä»£ç†(Proxying)ï¼Œè€Œ AspectJ åŸºäºå­—èŠ‚ç æ“ä½œ(Bytecode Manipulation)


## Bean
> bean ä»£æŒ‡çš„å°±æ˜¯é‚£äº›è¢« IoC å®¹å™¨æ‰€ç®¡ç†çš„å¯¹è±¡  
> å¯ä»¥é€šè¿‡ `xml` æˆ–è€…æ³¨è§£é…ç½®bean

### beançš„ä½œç”¨åŸŸ
- `prototype` å¤šå®ä¾‹ è°ƒç”¨(è·å–Bean)æ—¶åˆ›å»º
- `singleton` å•å®ä¾‹ **é»˜è®¤å€¼**  IOCå®¹å™¨å¯åŠ¨å³åˆ›å»º
- ~~request åŒä¸€æ¬¡è¯·æ±‚åˆ›å»ºä¸€ä¸ªå®ä¾‹~~
- ~~session åŒä¸€ä¸ªsession åˆ›å»ºä¸€ä¸ªå®ä¾‹~~


### å•ä¾‹beançš„çº¿ç¨‹å®‰å…¨é—®é¢˜
> å¦‚æœbean å®ä¾‹ä¸­æœ‰å®šä¹‰å¯å˜çš„æˆå‘˜å˜é‡ ,å½“å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªbeanå­˜åœ¨èµ„æºç«äº‰

è§£å†³åŠæ³•:  
- åœ¨beanä¸­å°½é‡é¿å…å®šä¹‰å¯å˜çš„æˆå‘˜å˜é‡
- ä½¿ç”¨ `ThreadLocal` å®šä¹‰æˆå‘˜å˜é‡,é€šè¿‡å…¶ `get` `set` æ–¹æ³•ä¿®æ”¹å€¼

### @component @beanåŒºåˆ«
> `@Component` ä½œç”¨äºç±»,é€šè¿‡ç±»è·¯å¾„æ‰«æ(@ComponentScan)æˆ–è€…è‡ªåŠ¨ä¾¦æµ‹è£…é…åˆ°å®¹å™¨ä¸­
> `@Bean` ä½œç”¨äºæ–¹æ³•,é€šè¿‡ä¸»åŠ¨é…ç½®è£…é…,è‡ªå®šä¹‰æ€§æ›´å¼º,å¾ˆå¤šåœ°æ–¹åªèƒ½ä½¿ç”¨`@Bean` æ¥æ³¨å†Œ,å¦‚å¼•ç”¨ç¬¬ä¸‰æ–¹ç±»åº“é…ç½®


### å£°æ˜ä¸ºBean çš„æ³¨è§£
- @Component
- @Bean
- @Repository
- @Service
- @Controller

### Bean çš„ç”Ÿå‘½å‘¨æœŸ
- 1. é€šè¿‡æ„é€ å™¨åˆ›å»ºBean å®ä¾‹(æ— å‚æ„é€ )  
- 2. è®¾ç½®Beançš„å±æ€§å€¼å’Œå¯¹å…¶ä»–Beançš„å¼•ç”¨(è°ƒç”¨Setæ–¹æ³•)
- 3. æŠŠ bean å®ä¾‹ä¼ é€’ bean å‰ç½®å¤„ç†å™¨çš„æ–¹æ³• `postProcessBeforeInitialization` 
- 4. è°ƒç”¨ bean çš„åˆå§‹åŒ–çš„æ–¹æ³•ï¼ˆéœ€è¦è¿›è¡Œé…ç½®åˆå§‹åŒ–çš„æ–¹æ³•ï¼‰`init-method`  
- 5. æŠŠ bean å®ä¾‹ä¼ é€’ bean åç½®å¤„ç†å™¨çš„æ–¹æ³• `postProcessAfterInitialization`  
- 6. beanå¯ä»¥è°ƒç”¨äº†(åˆå§‹åŒ–å®Œæˆ å¯ä»¥ä½¿ç”¨)
- 7. å½“å®¹å™¨å…³é—­æ—¶å€™ï¼Œè°ƒç”¨ bean çš„é”€æ¯çš„æ–¹æ³•ï¼ˆéœ€è¦è¿›è¡Œé…ç½®é”€æ¯çš„æ–¹æ³•ï¼‰`destroy-method` 

> å…³äº `initMethod` `destroyMethod`   
> xmlé…ç½® `init-method="initMethod" destroy-method="destoryMethod"`   
> æ³¨è§£ `@Bean(initMethod = "initMethod",destroyMethod = "destroyMethod" )`  



## SpringMVC æµç¨‹
- å®¢æˆ·ç«¯å‘é€è¯·æ±‚,ç›´æ¥åˆ° `DispatcherServlet`
- `DispatcherServlet` æ ¹æ®è¯·æ±‚ä¿¡æ¯è°ƒç”¨ `HandlerMapping` è§£æè¯·æ±‚å¯¹åº”çš„ `Handler`(Controller)
- åˆ°è¾¾ `Handler` å,ç”±`HandlerAdapter` é€‚é…å™¨å¤„ç†
- `HandlerAdapter` æ ¹æ®`Handler` è°ƒç”¨çœŸæ­£çš„å¤„ç†å™¨å¼€å§‹å¤„ç†è¯·æ±‚,æ‰§è¡Œä¸šåŠ¡é€»è¾‘
- è¿”å›`ModelAndView` `Model` æ˜¯æ•°æ®å¯¹è±¡, `View` æ˜¯é€»è¾‘ä¸Šçš„ `View` 
- `ViewResolver` æ ¹æ® `View` æŸ¥æ‰¾çœŸå®çš„View
- `DispaterServlet` æŠŠè¿”å›çš„ `Model` ä¼ ç»™ `View` (è§†å›¾æ¸²æŸ“)
- æŠŠ `View` è¿”å›ç»™æµè§ˆå™¨  


## Spring ç”¨åˆ°äº†é‚£äº›è®¾è®¡æ¨¡å¼
- å·¥å‚æ¨¡å¼ BeanFactory ApplicationContext
- ä»£ç†æ¨¡å¼ Spring Aop
- å•ä¾‹è®¾è®¡æ¨¡å¼ Bean é»˜è®¤å•ä¾‹
- é€‚é…å™¨æ¨¡å¼ AOPå¢å¼º(é€šçŸ¥) 


## Spring äº‹åŠ¡
- åŸå­æ€§: ä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œ,è¦ä¹ˆå…¨éƒ¨æˆåŠŸ,è¦ä¹ˆå…¨å¤±è´¥
- ä¸€è‡´æ€§:äº‹åŠ¡å¼€å§‹å’Œç»“æŸåæ•°æ®çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´å
- éš”ç¦»æ€§:æ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡,åŒæ—¶å¯¹æ•°æ®è¿›è¡Œè¯»å†™,éš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘å¯¼è‡´æ•°æ®ä¸ä¸€è‡´
- æŒä¹…æ€§: äº‹åŠ¡ç»“æŸå,å¯¹æ•°æ®çš„ä¿®æ”¹æ˜¯æ°¸ä¹…çš„


> ä½ çš„ç¨‹åºæ˜¯å¦æ”¯æŒäº‹åŠ¡é¦–å…ˆå–å†³äºæ•°æ®åº“ ï¼Œæ¯”å¦‚ä½¿ç”¨ MySQL çš„è¯ï¼Œå¦‚æœä½ é€‰æ‹©çš„æ˜¯ `innodb` å¼•æ“å¯ä»¥æ”¯æŒäº‹åŠ¡çš„ã€‚
> ä½†æ˜¯ï¼Œå¦‚æœä½ çš„ MySQL æ•°æ®åº“ä½¿ç”¨çš„æ˜¯ `myisam` å¼•æ“çš„è¯ï¼Œé‚£ä¸å¥½æ„æ€ï¼Œä»æ ¹ä¸Šå°±æ˜¯ä¸æ”¯æŒäº‹åŠ¡çš„  

### mysql æ€ä¹ˆä¿è¯åŸå­æ€§
> è¦åœ¨å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œå¯¹å·²ç»æ‰§è¡Œçš„æ“ä½œè¿›è¡Œå›æ»šï¼Œåœ¨ `MySQL` ä¸­ï¼Œæ¢å¤æœºåˆ¶æ˜¯é€šè¿‡ `å›æ»šæ—¥å¿—ï¼ˆundo logï¼‰` å®ç°çš„

### ç¼–ç¨‹å¼äº‹åŠ¡ å’Œ å£°æ˜å¼äº‹åŠ¡
- ç¼–ç¨‹å¼äº‹åŠ¡: é€šè¿‡ `TransactionTemplate` æˆ–è€… `TransactionManager` æ‰‹åŠ¨ç®¡ç†äº‹åŠ¡ï¼Œå®é™…åº”ç”¨ä¸­å¾ˆå°‘ä½¿ç”¨
- å£°æ˜å¼äº‹åŠ¡: åœ¨ XML é…ç½®æ–‡ä»¶ä¸­é…ç½®æˆ–è€…ç›´æ¥åŸºäºæ³¨è§£ï¼ˆæ¨èä½¿ç”¨ï¼‰: å®é™…æ˜¯é€šè¿‡ AOP å®ç°ï¼ˆåŸºäº`@Transactional` çš„å…¨æ³¨è§£æ–¹å¼ä½¿ç”¨æœ€å¤šï¼‰


é…ç½®:  

xmlé…ç½®æ–‡ä»¶é…ç½®:  
```xml
<!-- åˆ›å»ºäº‹åŠ¡ç®¡ç†å™¨  -->
<bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
    <!-- æ³¨å…¥ æ•°æ®æº -->
    <property name="dataSource" ref="dataSource"/>
</bean>
<!-- å¼€å¯ äº‹åŠ¡ æ³¨è§£  -->
<tx:annotation-driven transaction-manager="transactionManager"/>
```

æ³¨è§£é…ç½®:  
`@EnableTransactionManagement`   
`@Transactional(propagation = Propagation.REQUIRED, isolation = Isolation.REPEATABLE_READ, timeout = -1, readOnly = false, rollbackFor = {}, noRollbackFor = {})`



- `propagation` äº‹åŠ¡ä¼ æ’­è¡Œä¸º
- `isolation` äº‹åŠ¡éš”ç¦»çº§åˆ«
- `timeout` è¶…æ—¶æ—¶é—´
- `readOnly` æ˜¯å¦åªè¯»,é»˜è®¤false ,è®¾ç½®ä¸ºtrue åªèƒ½è¯»ä¸èƒ½å†™
- `rollbackFor` å‡ºç°é‚£äº›å¼‚å¸¸è¿›è¡Œå›æ»š
- `noRollbackFor` å‡ºç°é‚£äº›å¼‚å¸¸ä¸å›æ»š

æ³¨æ„:
- `@Transactional` åªèƒ½ä½œç”¨åœ¨public æ–¹æ³•ä¸Š
- å¦‚æœå†™åœ¨ç±»ä¸Š,é‚£ä¹ˆå¯¹ç±»ä¸­æ‰€æœ‰çš„public æ–¹æ³•ç”Ÿæ•ˆ
- ä¸æ¨èåœ¨æ¥å£ä¸Šä½¿ç”¨
- `@Transactional` æ³¨è§£çš„æ–¹æ³•æ‰€åœ¨çš„ç±»**å¿…é¡»**è¢« `Spring` ç®¡ç†ï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆ

[Springäº‹åŠ¡](Java/Spring?id=äº‹åŠ¡) 

## å¸¸ç”¨æ³¨è§£  

### Bean ç›¸å…³
- `@Configuration` å…è®¸åœ¨ Spring ä¸Šä¸‹æ–‡ä¸­æ³¨å†Œé¢å¤–çš„ bean æˆ–å¯¼å…¥å…¶ä»–é…ç½®ç±»
- `@ComponentScan` value å±æ€§æŒ‡å®šè¦æ‰«æçš„åŒ…,å°±å¯ä»¥å°† `@Component @Controller @Service @Repository` æ³¨è§£çš„ç±»æ”¾å…¥IOCå®¹å™¨ä¸­
- `@Autowired` `@Qualifier("bookDao2")` æŒ‡å®šå¯»æ‰¾idä¸ºbookDao2 çš„bean
- `@Primary` æ³¨è§£è®¾ç½® Beançš„é»˜è®¤è£…é…ä¼˜å…ˆçº§
- `@Scope` è®¾ç½®å•å®ä¾‹
- `@GetMapping("users")` ç­‰ä»·äº `@RequestMapping(value="/users",method=RequestMethod.GET)` 


### ä¼ å€¼
- `@PathVariable`
- `@RequestHeader`
- `@RequestParam`
- `@CookieValue`


### é…ç½®ä¿¡æ¯
- `@Value("${property}")` `@Value("å¼ ä¸‰")` ,ä¹Ÿæ”¯æŒSpEL `@Value("#{20-3}")`
- `@ConfigurationProperties(prefix = "person")`
- `@PropertySource(value = {"classpath:/application.properties"})`

### å¼‚å¸¸å¤„ç†
- `@ControllerAdvice + @ExceptionHandler` å¤„ç†å…¨å±€å¼‚å¸¸;åº•å±‚æ˜¯ `ExceptionHandlerExceptionResolver` æ”¯æŒ
- `@ResponseStatus + è‡ªå®šä¹‰å¼‚å¸¸` åº•å±‚æ˜¯ ResponseStatusExceptionResolver

```java
@ControllerAdvice
public class ExceptionHandlerTest {

  @ExceptionHandler({NullPointerException.class,ArrayIndexOutOfBoundsException.class})
  public String handlerExceptionTest(Exception e){

      //æ”¯æŒç›´æ¥è¿”å›è§†å›¾
      return "login";
  }
}

@ResponseStatus(value = HttpStatus.FORBIDDEN,reason = "ç”¨æˆ·æ•°é‡å¤ªå¤š")
public class UserTooManyException extends RuntimeException {
    public UserTooManyException(String message) {
        super(message);
    }
}

```


## è‡ªåŠ¨é…ç½®åŸç†

`@SpringBootApplication` å†…éƒ¨  

```java
@SpringBootConfiguration
@EnableAutoConfiguration
@ComponentScan(excludeFilters = { @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),
        @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) })
public @interface SpringBootApplication{}
```
`@EnableAutoConfiguration`  å†…éƒ¨  

```java
@AutoConfigurationPackage
@Import({AutoConfigurationImportSelector.class})
public @interface EnableAutoConfiguration {
    String ENABLED_OVERRIDE_PROPERTY = "spring.boot.enableautoconfiguration";

    Class<?>[] exclude() default {};

    String[] excludeName() default {};
}
``` 


> 1. spring bootå…ˆåŠ è½½æ‰€æœ‰è‡ªåŠ¨é…ç½®ç±» ***AutoConfiguration
> 2. æ¯ä¸ªé…ç½®ç±»æŒ‰ç…§å…¶å†…éƒ¨æ¡ä»¶ç”Ÿæ•ˆ,é»˜è®¤éƒ½ä¼šç»‘å®šé…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„å€¼`(xxxxxAutoConfiguration ---> xxxxProperties(@ConfigurationProperties) ----> application.properties)`
> 3. ç”Ÿæ•ˆçš„é…ç½®ç±»ä¼šç»™å®¹å™¨ä¸­è£…é…å¾ˆå¤šç»„ä»¶,æ ¹æ®å¯¹åº”é…ç½®æ–‡ä»¶è¿›è¡Œè£…é…
> 4. é…ç½®é¡¹ä¸­å¾ˆå¤šéœ€è¦æ¡ä»¶åŠ è½½ `@Conditional***` æ‰€ä»¥ä¸ä¼šåŠ è½½æ— ç”¨é…ç½®



## Junit 

[Junit5](Java/SpringBoot?id=junit5) 

- `@DisplayName` ä¸ºæµ‹è¯•ç±»æˆ–è€…æµ‹è¯•æ–¹æ³•è®¾ç½®å±•ç¤ºåç§°
- `@BeforeEach` è¡¨ç¤ºåœ¨æ¯ä¸ªå•å…ƒæµ‹è¯•å‰æ‰§è¡Œ
- `@AfterEach` æ¯ä¸ªå•å…ƒæµ‹è¯•åæ‰§è¡Œ
- `@BeforeAll` æ‰€æœ‰å•å…ƒæµ‹è¯•å‰æ‰§è¡Œ
- `@AfterAll` æ‰€æœ‰å•å…ƒæµ‹è¯•åæ‰§è¡Œ
- `@Tag` è¡¨ç¤ºå•å…ƒæµ‹è¯•ç±»åˆ«
- `@Disable` è¡¨ç¤ºæµ‹è¯•ç±»æˆ–è€…æµ‹è¯•æ–¹æ³•ä¸æ‰§è¡Œ
- `@Timeout` æµ‹è¯•æ–¹æ³•è¿è¡Œè¶…æ—¶æŠ¥é”™ é»˜è®¤ç§’,å¯ä»¥æŒ‡å®šå•ä½ 
- `@ExtendWith` ä¸ºæµ‹è¯•ç±»æˆ–è€…æµ‹è¯•æ–¹æ³•æä¾›æ‰©å±•ç±»å¼•ç”¨
- `@RepeatedTest` æŒ‡å®šé‡å¤æ‰§è¡Œæ¬¡æ•° ,é‡å¤æ‰§è¡Œæµ‹è¯•æ–¹æ³•


### æ–­è¨€

æ–¹æ³• | è¯´æ˜ | 
---------|----------|
 `assertEquals` | åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æˆ–ä¸¤ä¸ªåŸå§‹ç±»å‹æ˜¯å¦ç›¸ç­‰ | 
 `assertNotEquals` | åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æˆ–ä¸¤ä¸ªåŸå§‹ç±»å‹æ˜¯å¦ä¸ç›¸ç­‰ |
 `assertSame` | åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨æ˜¯å¦æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ |
 `assertNotSame` | åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨æ˜¯å¦æŒ‡å‘ä¸åŒçš„å¯¹è±¡ |
 `assertTrue` | åˆ¤æ–­ç»™å®šçš„å¸ƒå°”å€¼æ˜¯å¦ä¸º true |
 `assertFalse` | åˆ¤æ–­ç»™å®šçš„å¸ƒå°”å€¼æ˜¯å¦ä¸º false |
 `assertNull` | åˆ¤æ–­ç»™å®šçš„å¯¹è±¡å¼•ç”¨æ˜¯å¦ä¸º nul |
 `assertNotNull` | åˆ¤æ–­ç»™å®šçš„å¯¹è±¡å¼•ç”¨æ˜¯å¦ä¸ä¸º null |
 `assertArrayEquals` | åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æˆ–åŸå§‹ç±»å‹çš„æ•°ç»„æ˜¯å¦ç›¸ç­‰ |

# MyBatis

## #{}å’Œ${}çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ
- `${}` æ˜¯propertiesæ–‡ä»¶ä¸­çš„å˜é‡å ä½ç¬¦,å±äºé™æ€æ–‡æœ¬æ›¿æ¢,å¯¹åº”ä½ç½®ä¼šè¢«æ›¿æ¢ä¸ºå‚æ•°å€¼
- `#{}` mybatis ä¼šå°†sqlä¸­çš„ `#{}` æ›¿æ¢ä¸º ? å·,åœ¨sqlæ‰§è¡Œå‰ä¼šå°†?æ›¿æ¢ä¸ºå‚æ•°å€¼

## Xml æ˜ å°„æ–‡ä»¶ä¸­æ ‡ç­¾
- `select|insert|update|delete`
- `resultMap|sql|include`
- `trim|where|if|choose|when|otherwise|foreach`

## Dao æ¥å£çš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆï¼ŸDao æ¥å£é‡Œçš„æ–¹æ³•ï¼Œå‚æ•°ä¸åŒæ—¶ï¼Œæ–¹æ³•èƒ½é‡è½½å— 
> Daoæ¥å£çš„å…¨é™å®šç±»åå°±æ˜¯æ˜ å°„xmlæ–‡ä»¶çš„namespaceå€¼,æ–¹æ³•åå°±æ˜¯xmlæ–‡ä»¶`MappedStatement`ä¸­çš„idå€¼,æ–¹æ³•å‚æ•°å°±æ˜¯ä¼ é€’ç»™sqlçš„å‚æ•°
> é€šè¿‡æ¥å£å…¨é™å®šç±»å+æ–¹æ³•å å¯ä»¥å”¯ä¸€å®šä½ä¸€ä¸ª `MappedStatement` 
> `com.mybatis3.mappers.StudentDao.findStudentById` å°±ä¼šæ‰¾åˆ° namespace ä¸º`com.mybatis3.mappers.StudentDao` ä¸‹ idä¸º`findStudentById` çš„`MappedStatement`

> Dao æ¥å£é‡Œçš„æ–¹æ³•å¯ä»¥é‡è½½ï¼Œä½†æ˜¯ Mybatis çš„ XML é‡Œé¢çš„ ID ä¸å…è®¸é‡å¤ 
> Dao æ¥å£æ–¹æ³•å¯ä»¥é‡è½½ï¼Œä½†æ˜¯éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶:
> > ä»…æœ‰ä¸€ä¸ªæ— å‚æ–¹æ³•å’Œä¸€ä¸ªæœ‰å‚æ–¹æ³•,å¤šä¸ªæœ‰å‚æ–¹æ³•æ—¶ï¼Œå‚æ•°æ•°é‡å¿…é¡»ä¸€è‡´  

## MyBatis æ‰§è¡Œæ‰¹é‡æ’å…¥ï¼Œèƒ½è¿”å›æ•°æ®åº“ä¸»é”®åˆ—è¡¨å—ï¼Ÿ 
æ‰¹é‡æ’å…¥å’Œå•æ¡æ’å…¥é“ç†ç›¸åŒ   
- `useGeneratedKeys` å¼€å¯è‡ªå¢,æ ‡è¯†å…¶ä½¿ç”¨äº†è‡ªå¢id
- `keyProperty` å°†è‡ªå¢çš„ä¸»é”®çš„å€¼èµ‹å€¼ç»™å¯¹åº”å®ä½“ç±»çš„å±æ€§(èµ‹å€¼ç»™idå±æ€§)

## åŠ¨æ€sql
> `if` `where` `trim` `choose when otherwise` `foreach` `sql include`


## MyBatiså¦‚ä½•å°è£…è¿”å›ç»“æœ
-  ä½¿ç”¨`<resultMap>` æ ‡ç­¾æŒ‡å®šæ˜ å°„å…³ç³»
-  ä½¿ç”¨åˆ«åä½œä¸ºå±æ€§å,è‡ªåŠ¨æ˜ å°„åŒ¹é…

## MyBatis å¤šå¯¹ä¸€\ä¸€å¯¹å¤š æŸ¥è¯¢ 

### å¤šå¯¹ä¸€ä¸‰ç§æ–¹æ³•
[MyBatiså¤šå¯¹ä¸€ä¸‰ç§æ–¹æ³•](Java/MyBatis?id=å¤šå¯¹ä¸€æ˜ å°„å…³ç³»å¤„ç†çš„ä¸‰ç§æ–¹æ³•)

- é€šè¿‡çº§è”å±æ€§èµ‹å€¼
- é€šè¿‡ `association` æ ‡ç­¾
- é€šè¿‡ `association` æ ‡ç­¾ + åˆ†å¸ƒæŸ¥è¯¢

### ä¸€å¯¹å¤š ä¸¤ç§
[MyBatisä¸€å¯¹å¤š ä¸¤ç§æ–¹æ³•](Java/MyBatis?id=è§£å†³ä¸€å¯¹å¤šæ˜ å°„)
- ä½¿ç”¨ `collection` æ ‡ç­¾
- åˆ†æ­¥æŸ¥è¯¢

## MyBatis çš„å»¶è¿ŸåŠ è½½
> MyBatis ä»…æ”¯æŒ `association` å…³è”å¯¹è±¡å’Œ `collection` å…³è”é›†åˆå¯¹è±¡çš„å»¶è¿ŸåŠ è½½ï¼Œ `association` æŒ‡çš„å°±æ˜¯ä¸€å¯¹ä¸€ï¼Œ `collection` æŒ‡çš„å°±æ˜¯ä¸€å¯¹å¤šæŸ¥è¯¢

> `azyLoadingEnabled` :å»¶è¿ŸåŠ è½½çš„å…¨å±€å¼€å…³,å½“å¼€å¯æ—¶,æ‰€æœ‰å…³è”å¯¹è±¡(åˆ†å¸ƒæŸ¥è¯¢çš„ç¬¬äºŒæ­¥,ç¬¬ä¸‰æ­¥...)éƒ½ä¼šå»¶è¿ŸåŠ è½½
> `aggressiveLazyLoading` :å½“å¼€å¯æ—¶,ä»»ä½•æ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šåŠ è½½è¯¥å¯¹è±¡çš„æ‰€æœ‰å±æ€§,å¦åˆ™æ¯ä¸ªå±æ€§ä¼šæŒ‰éœ€åŠ è½½
ä½¿ç”¨é…ç½®æ–‡ä»¶æˆ–è€…xmlé…ç½®è¿›è¡Œé…ç½®å¼€å¯å»¶è¿ŸåŠ è½½  
```xml
  <settings>
        <!-- å¼€å¯å…¨å±€å»¶è¿ŸåŠ è½½-->
        <setting name="lazyLoadingEnabled" value="true"/>
    </settings>
```

æˆ–è€…

```properties
mybatis.configuration.lazy-loading-enabled=true
#false ä¸ºæŒ‰éœ€åŠ è½½
mybatis.configuration.aggressive-lazy-loading=false

```

![](https://hexoric-1310528773.cos.ap-beijing.myqcloud.com/hexo/mybatis2.png)

> åŸºæœ¬åŸç†: ä½¿ç”¨ `CGLIB` åˆ›å»ºç›®æ ‡ä½ å¯¹è±¡çš„ä»£ç†å¯¹è±¡,å½“è°ƒç”¨ç›®æ ‡æ–¹æ³•æ˜¯,è¿›å…¥æ‹¦æˆªå™¨æ–¹æ³•,æ¯”å¦‚è°ƒç”¨ `a.getB().getName()` ï¼Œ
> æ‹¦æˆªå™¨` invoke()` æ–¹æ³•å‘ç° `a.getB()` æ˜¯ `null` å€¼ï¼Œé‚£ä¹ˆå°±ä¼šå•ç‹¬å‘é€äº‹å…ˆä¿å­˜å¥½çš„æŸ¥è¯¢å…³è” B å¯¹è±¡çš„ sqlï¼ŒæŠŠ B æŸ¥è¯¢ä¸Šæ¥ï¼Œ
> ç„¶åè°ƒç”¨ `a.setB(b)`ï¼Œäºæ˜¯ a çš„å¯¹è±¡ b å±æ€§å°±æœ‰å€¼äº†ï¼Œæ¥ç€å®Œæˆ a.getB().getName() æ–¹æ³•çš„è°ƒç”¨

## MyBatis çš„ Xml æ˜ å°„æ–‡ä»¶ä¸­ï¼Œä¸åŒçš„ Xml æ˜ å°„æ–‡ä»¶ï¼Œid æ˜¯å¦å¯ä»¥é‡å¤
> ä¸åŒçš„xmlæ–‡ä»¶,å¦‚æœé…ç½®äº†namespace é‚£ä¹ˆidå¯ä»¥é‡å¤,å¦‚æœæ²¡æœ‰é…ç½®namespace é‚£ä¹ˆidä¸èƒ½é‡å¤
> åŸå› å°±æ˜¯ ä½¿ç”¨äº†`namespace+id`(å³ mapperå…¨é™å®šç±»å+æ–¹æ³•å) ä½œä¸º `Map<String, MappedStatement>` çš„ keyä½¿ç”¨


## â­MyBatis ä¸­å¦‚ä½•æ‰§è¡Œæ‰¹å¤„ç†
> ä½¿ç”¨ `BatchExecutor` å®Œæˆæ‰¹å¤„ç†  


## â­MyBatis éƒ½æœ‰å“ªäº› Executor æ‰§è¡Œå™¨ï¼Ÿå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ  
> MyBatis æœ‰ä¸‰ç§åŸºæœ¬çš„ Executor æ‰§è¡Œå™¨ï¼Œ `SimpleExecutor` ã€ `ReuseExecutor` ã€ `BatchExecutor`  

- `SimpleExecutor` æ¯æ‰§è¡Œä¸€æ¬¡updateæˆ–è€…select å°±å¼€å¯ä¸€ä¸ªStatement å¯¹è±¡,ç”¨å®Œç«‹å³å…³é—­ Statement å¯¹è±¡

## MyBatis æ˜ å°„æ–‡ä»¶ä¸­ï¼Œå¦‚æœ A æ ‡ç­¾é€šè¿‡ include å¼•ç”¨äº† B æ ‡ç­¾çš„å†…å®¹ï¼Œè¯·é—®ï¼ŒB æ ‡ç­¾èƒ½å¦å®šä¹‰åœ¨ A æ ‡ç­¾çš„åé¢ï¼Œè¿˜æ˜¯è¯´å¿…é¡»å®šä¹‰åœ¨ A æ ‡ç­¾çš„å‰é¢
éšä¾¿ æ— é¡ºåºä¹‹åˆ†
> MyBatis è§£æ A æ ‡ç­¾ï¼Œå‘ç° A æ ‡ç­¾å¼•ç”¨äº† B æ ‡ç­¾ï¼Œä½†æ˜¯ B æ ‡ç­¾å°šæœªè§£æåˆ°ï¼Œå°šä¸å­˜åœ¨ï¼Œ
> æ­¤æ—¶ï¼ŒMyBatis ä¼šå°† A æ ‡ç­¾æ ‡è®°ä¸ºæœªè§£æçŠ¶æ€ï¼Œç„¶åç»§ç»­è§£æä½™ä¸‹çš„æ ‡ç­¾ï¼ŒåŒ…å« B æ ‡ç­¾ï¼Œå¾…æ‰€æœ‰æ ‡ç­¾è§£æå®Œæ¯•ï¼Œ
> MyBatis ä¼šé‡æ–°è§£æé‚£äº›è¢«æ ‡è®°ä¸ºæœªè§£æçš„æ ‡ç­¾ï¼Œæ­¤æ—¶å†è§£æ A æ ‡ç­¾æ—¶ï¼ŒB æ ‡ç­¾å·²ç»å­˜åœ¨ï¼ŒA æ ‡ç­¾ä¹Ÿå°±å¯ä»¥æ­£å¸¸è§£æå®Œæˆäº†


## ç®€è¿° MyBatis çš„ Xml æ˜ å°„æ–‡ä»¶å’Œ MyBatis å†…éƒ¨æ•°æ®ç»“æ„ä¹‹é—´çš„æ˜ å°„å…³ç³»

> åœ¨ Xml æ˜ å°„æ–‡ä»¶ä¸­ï¼Œ `<parameterMap>` æ ‡ç­¾ä¼šè¢«è§£æä¸º `ParameterMap` å¯¹è±¡ï¼Œå…¶æ¯ä¸ªå­å…ƒç´ ä¼šè¢«è§£æä¸º `ParameterMapping` å¯¹è±¡ã€‚ 
> `<resultMap>` æ ‡ç­¾ä¼šè¢«è§£æä¸º `ResultMap` å¯¹è±¡ï¼Œå…¶æ¯ä¸ªå­å…ƒç´ ä¼šè¢«è§£æä¸º `ResultMapping` å¯¹è±¡ã€‚
> æ¯ä¸€ä¸ª `<select>ã€<insert>ã€<update>ã€<delete>` æ ‡ç­¾å‡ä¼šè¢«è§£æä¸º `MappedStatement` å¯¹è±¡ï¼Œæ ‡ç­¾å†…çš„ sql ä¼šè¢«è§£æä¸º `BoundSql` å¯¹è±¡


## ä¸€çº§ç¼“å­˜ 
> ä¸€çº§ç¼“å­˜æ˜¯ `SqlSession` çº§åˆ«çš„,é»˜è®¤å¼€å¯,é€šè¿‡åŒä¸€ä¸ª `SqlSession` æŸ¥è¯¢çš„æ•°æ®ä¼šè¢«ç¼“å­˜,
> ä¸‹æ¬¡æŸ¥è¯¢ç›¸åŒçš„æ•°æ®,å°±ä¼šä»ç¼“å­˜ä¸­ç›´æ¥è·å–,ä¸ä¼šä»æ•°æ®åº“é‡æ–°è®¿é—®

ä¸€çº§ç¼“å­˜å¤±æ•ˆçš„å››ç§æƒ…å†µ:   
- ä¸åŒçš„ `SqlSession` å¯¹åº”ä¸åŒçš„ä¸€çº§ç¼“å­˜
- åŒä¸€ä¸ª `SqlSession` ä½†æ˜¯æŸ¥è¯¢æ¡ä»¶ä¸åŒ
- åŒä¸€ä¸ª `SqlSession` ä¸¤æ¬¡æŸ¥è¯¢æœŸé—´æ‰§è¡Œäº†ä»»ä½•ä¸€æ¬¡å¢åˆ æ”¹æ“ä½œ
- åŒä¸€ä¸ª `SqlSession` ä¸¤æ¬¡æŸ¥è¯¢é—´æ‰‹åŠ¨æ¸…ç©ºäº†ç¼“å­˜ `sqlSession.clearCache();`



## äºŒçº§ç¼“å­˜
> äºŒçº§ç¼“å­˜æ˜¯ SqlSessionFactory çº§åˆ«, é€šè¿‡åŒä¸€ä¸ªSqlSessionFactory åˆ›å»ºçš„ SqlSessionæŸ¥è¯¢çš„ç»“æœä¼šè¢«ç¼“å­˜,
> æ­¤åè‹¥å†æ¬¡æ‰§è¡Œç›¸åŒçš„æŸ¥è¯¢è¯­å¥,ç»“æœå°±ä¼šä»ç¼“å­˜ä¸­è·å–

äºŒçº§ç¼“å­˜å¼€å¯çš„æ¡ä»¶:  
- åœ¨æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­,è®¾ç½®å…¨å±€é…ç½®å±æ€§ `cacheEnable=true` (é»˜è®¤ä¸ºtrue) 
- åœ¨æ˜ å°„æ–‡ä»¶ä¸­è®¾ç½®æ ‡ç­¾ `<cache />`
- äºŒçº§ç¼“å­˜å¿…é¡»å­˜åœ¨ `SqlSession` å…³é—­æˆ–æäº¤ä¹‹åæœ‰æ•ˆ,æäº¤ä¹‹å‰åœ¨ä¸€çº§ç¼“å­˜ä¸­
- æŸ¥è¯¢çš„æ•°æ®æ‰€è½¬æ¢çš„å®ä½“ç±»å‹å¿…é¡»å®ç°åºåˆ—åŒ–æ¥å£

> ä¸¤æ¬¡æŸ¥è¯¢ä¹‹é—´æ‰§è¡Œäº†ä»»æ„çš„å¢åˆ æ”¹æ“ä½œ,ä¼šä½¿ä¸€çº§å’ŒäºŒçº§ç¼“å­˜åŒæ—¶å¤±æ•ˆ  


## ç¼“å­˜æŸ¥è¯¢é¡ºåº  
- å…ˆæŸ¥è¯¢äºŒçº§ç¼“å­˜
- äºŒçº§æ²¡æœ‰å‘½ä¸­,æŸ¥è¯¢ä¸€çº§ç¼“å­˜
- ä¸€çº§æ²¡æœ‰å‘½ä¸­,æŸ¥è¯¢æ•°æ®åº“
- `SqlSession` å…³é—­åä¸€çº§ç¼“å­˜ä¸­çš„æ•°æ®ä¼šå†™å…¥äºŒçº§ç¼“å­˜





